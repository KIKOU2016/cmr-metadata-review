require 'test_helper'
require 'stub_data'

class CmrTest < ActiveSupport::TestCase

  describe "get_collections" do
    it "correctly gets collection from CMR api" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000020-LANCEAMSR2").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>9</took><result concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"8\" format=\"application/echo10+xml\">\n<Collection>\n<ShortName>A2_DySno_NRT</ShortName>\n<VersionId>0</VersionId>\n<InsertTime>2015-05-01T13:26:43Z</InsertTime>\n<LastUpdate>2015-09-14T13:26:43Z</LastUpdate>\n<LongName>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS</LongName>\n<DataSetId>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0</DataSetId>\n<Description>The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.</Description>\n<CollectionDataType>NEAR_REAL_TIME</CollectionDataType>\n<Orderable>false</Orderable>\n<Visible>true</Visible>\n<ProcessingLevelId>3</ProcessingLevelId>\n<ArchiveCenter>GHRC</ArchiveCenter>\n<CitationForExternalPublication>Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</CitationForExternalPublication><Price>0.0</Price><SpatialKeywords>\n<Keyword>GLOBAL</Keyword></SpatialKeywords><TemporalKeywords>\n<Keyword>DAILY</Keyword></TemporalKeywords><Temporal><RangeDateTime>\n<BeginningDateTime>2015-05-01T00:00:00Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact>\n<Role>GHRC USER SERVICES</Role><OrganizationEmails>\n<Email>ghrc-dmg@itsc.uah.edu</Email></OrganizationEmails></Contact></Contacts><ScienceKeywords><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>CRYOSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>TERRESTRIAL HYDROSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform>\n<ShortName>GCOM-W1</ShortName>\n<LongName>GCOM-W1</LongName>\n<Type>SATELLITE</Type><Instruments><Instrument>\n<ShortName>AMSR2</ShortName><Sensors><Sensor>\n<ShortName>AMSR2</ShortName></Sensor></Sensors></Instrument></Instruments></Platform></Platforms>\n<AdditionalAttributes>\n<AdditionalAttribute>\n<Name>identifier_product_doi</Name>\n<DataType>STRING</DataType>\n<Description>product DOI</Description>\n<Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n</AdditionalAttribute>\n<AdditionalAttribute>\n<Name>identifier_product_doi_authority</Name>\n<DataType>STRING</DataType>\n<Description>DOI authority</Description>\n<Value>http://dx.doi.org</Value>\n</AdditionalAttribute>\n</AdditionalAttributes>\n<Campaigns><Campaign>\n<ShortName>LANCE</ShortName></Campaign></Campaigns><OnlineAccessURLs><OnlineAccessURL>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><URLDescription></URLDescription><MimeType></MimeType></OnlineAccessURL></OnlineAccessURLs><OnlineResources><OnlineResource>\n<URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><Description></Description>\n<Type>Alternate Data Access</Type></OnlineResource><OnlineResource>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/</URL><Description></Description>\n<Type>Browse</Type></OnlineResource><OnlineResource>\n<URL>https://worldview.earthdata.nasa.gov/</URL><Description></Description>\n<Type>Worldview Imagery</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/</URL><Description></Description>\n<Type>Homepage</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf</URL><Description></Description>\n<Type>Guide</Type></OnlineResource><OnlineResource>\n<URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL><Description></Description>\n<Type>DOI</Type></OnlineResource><OnlineResource>\n<URL>http://ghrc.nsstc.nasa.gov/uso/citation.html</URL><Description></Description>\n<Type>Citing GHRC Data</Type></OnlineResource></OnlineResources><AssociatedDIFs><DIF>\n<EntryId>A2_DySno_NRT</EntryId></DIF></AssociatedDIFs><Spatial><SpatialCoverageType>Horizontal</SpatialCoverageType><HorizontalSpatialDomain><Geometry>\n<CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle>\n<WestBoundingCoordinate>-180</WestBoundingCoordinate>\n<NorthBoundingCoordinate>90</NorthBoundingCoordinate>\n<EastBoundingCoordinate>180</EastBoundingCoordinate>\n<SouthBoundingCoordinate>-90</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain>\n<GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation></Spatial>\n<MetadataStandardName>ECHO</MetadataStandardName>\n<MetadataStandardVersion>10</MetadataStandardVersion>\n</Collection></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")

      assert_equal(collection, {"CollectionState"=>"", "ShortName"=>"A2_DySno_NRT", "VersionId"=>"0", "InsertTime"=>"2015-05-01T13:26:43Z", "LastUpdate"=>"2015-09-14T13:26:43Z", "LongName"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS", "DataSetId"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0", "Description"=>"The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.", "CollectionDataType"=>"NEAR_REAL_TIME", "Orderable"=>"false", "Visible"=>"true", "ProcessingLevelId"=>"3", "ArchiveCenter"=>"GHRC", "CitationForExternalPublication"=>"Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "Price"=>"0.0", "SpatialKeywords/Keyword"=>"GLOBAL", "TemporalKeywords/Keyword"=>"DAILY", "Temporal/RangeDateTime/BeginningDateTime"=>"2015-05-01T00:00:00Z", "Contacts/Contact/Role"=>"GHRC USER SERVICES", "Contacts/Contact/OrganizationEmails/Email"=>"ghrc-dmg@itsc.uah.edu", "ScienceKeywords/ScienceKeyword0/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword0/TopicKeyword"=>"CRYOSPHERE", "ScienceKeywords/ScienceKeyword0/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword0/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "ScienceKeywords/ScienceKeyword1/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword1/TopicKeyword"=>"TERRESTRIAL HYDROSPHERE", "ScienceKeywords/ScienceKeyword1/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword1/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "Platforms/Platform/ShortName"=>"GCOM-W1", "Platforms/Platform/LongName"=>"GCOM-W1", "Platforms/Platform/Type"=>"SATELLITE", "Platforms/Platform/Instruments/Instrument/ShortName"=>"AMSR2", "Platforms/Platform/Instruments/Instrument/Sensors/Sensor/ShortName"=>"AMSR2", "AdditionalAttributes/AdditionalAttribute0/Name"=>"identifier_product_doi", "AdditionalAttributes/AdditionalAttribute0/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute0/Description"=>"product DOI", "AdditionalAttributes/AdditionalAttribute0/Value"=>"10.5067/AMSR2/A2_DySno_NRT", "AdditionalAttributes/AdditionalAttribute1/Name"=>"identifier_product_doi_authority", "AdditionalAttributes/AdditionalAttribute1/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute1/Description"=>"DOI authority", "AdditionalAttributes/AdditionalAttribute1/Value"=>"http://dx.doi.org", "Campaigns/Campaign/ShortName"=>"LANCE", "OnlineAccessURLs/OnlineAccessURL/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/URL"=>"https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/Type"=>"Alternate Data Access", "OnlineResources/OnlineResource1/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/", "OnlineResources/OnlineResource1/Type"=>"Browse", "OnlineResources/OnlineResource2/URL"=>"https://worldview.earthdata.nasa.gov/", "OnlineResources/OnlineResource2/Type"=>"Worldview Imagery", "OnlineResources/OnlineResource3/URL"=>"http://lance.nsstc.nasa.gov/", "OnlineResources/OnlineResource3/Type"=>"Homepage", "OnlineResources/OnlineResource4/URL"=>"http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf", "OnlineResources/OnlineResource4/Type"=>"Guide", "OnlineResources/OnlineResource5/URL"=>"http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "OnlineResources/OnlineResource5/Type"=>"DOI", "OnlineResources/OnlineResource6/URL"=>"http://ghrc.nsstc.nasa.gov/uso/citation.html", "OnlineResources/OnlineResource6/Type"=>"Citing GHRC Data", "AssociatedDIFs/DIF/EntryId"=>"A2_DySno_NRT", "Spatial/SpatialCoverageType"=>"Horizontal", "Spatial/HorizontalSpatialDomain/Geometry/CoordinateSystem"=>"CARTESIAN", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/WestBoundingCoordinate"=>"-180", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/NorthBoundingCoordinate"=>"90", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/EastBoundingCoordinate"=>"180", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/SouthBoundingCoordinate"=>"-90", "Spatial/GranuleSpatialRepresentation"=>"CARTESIAN", "MetadataStandardName"=>"ECHO", "MetadataStandardVersion"=>"10", "DataFormat"=>""})

    end

    it "raises error when concept_id invalid" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=junk-name").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => '{"errors"=>{"error"=>"Concept-id [junk-name] is not valid."}}', :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})

      error = false
      begin
        collection = Cmr.get_collection("junk-name")
      rescue Cmr::CmrError
        error = true
      end

      assert_equal(error, true)
    end

    it "raises error when concept_id is not found" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000042-LANCEAMSR3").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => '<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>0</hits><took>21</took></results>', :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})

      error = false
      begin
        collection = Cmr.get_collection("C1000000042-LANCEAMSR3")
      rescue Cmr::CmrError
        error = true
      end

      assert_equal(error, true)
    end

    it "correctly flattens results from collection" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000020-LANCEAMSR2").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>9</took><result concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"8\" format=\"application/echo10+xml\">\n<Collection>\n<ShortName>A2_DySno_NRT</ShortName>\n<VersionId>0</VersionId>\n<InsertTime>2015-05-01T13:26:43Z</InsertTime>\n<LastUpdate>2015-09-14T13:26:43Z</LastUpdate>\n<LongName>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS</LongName>\n<DataSetId>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0</DataSetId>\n<Description>The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.</Description>\n<CollectionDataType>NEAR_REAL_TIME</CollectionDataType>\n<Orderable>false</Orderable>\n<Visible>true</Visible>\n<ProcessingLevelId>3</ProcessingLevelId>\n<ArchiveCenter>GHRC</ArchiveCenter>\n<CitationForExternalPublication>Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</CitationForExternalPublication><Price>0.0</Price><SpatialKeywords>\n<Keyword>GLOBAL</Keyword></SpatialKeywords><TemporalKeywords>\n<Keyword>DAILY</Keyword></TemporalKeywords><Temporal><RangeDateTime>\n<BeginningDateTime>2015-05-01T00:00:00Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact>\n<Role>GHRC USER SERVICES</Role><OrganizationEmails>\n<Email>ghrc-dmg@itsc.uah.edu</Email></OrganizationEmails></Contact></Contacts><ScienceKeywords><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>CRYOSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>TERRESTRIAL HYDROSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform>\n<ShortName>GCOM-W1</ShortName>\n<LongName>GCOM-W1</LongName>\n<Type>SATELLITE</Type><Instruments><Instrument>\n<ShortName>AMSR2</ShortName><Sensors><Sensor>\n<ShortName>AMSR2</ShortName></Sensor></Sensors></Instrument></Instruments></Platform></Platforms>\n<AdditionalAttributes>\n<AdditionalAttribute>\n<Name>identifier_product_doi</Name>\n<DataType>STRING</DataType>\n<Description>product DOI</Description>\n<Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n</AdditionalAttribute>\n<AdditionalAttribute>\n<Name>identifier_product_doi_authority</Name>\n<DataType>STRING</DataType>\n<Description>DOI authority</Description>\n<Value>http://dx.doi.org</Value>\n</AdditionalAttribute>\n</AdditionalAttributes>\n<Campaigns><Campaign>\n<ShortName>LANCE</ShortName></Campaign></Campaigns><OnlineAccessURLs><OnlineAccessURL>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><URLDescription></URLDescription><MimeType></MimeType></OnlineAccessURL></OnlineAccessURLs><OnlineResources><OnlineResource>\n<URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><Description></Description>\n<Type>Alternate Data Access</Type></OnlineResource><OnlineResource>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/</URL><Description></Description>\n<Type>Browse</Type></OnlineResource><OnlineResource>\n<URL>https://worldview.earthdata.nasa.gov/</URL><Description></Description>\n<Type>Worldview Imagery</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/</URL><Description></Description>\n<Type>Homepage</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf</URL><Description></Description>\n<Type>Guide</Type></OnlineResource><OnlineResource>\n<URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL><Description></Description>\n<Type>DOI</Type></OnlineResource><OnlineResource>\n<URL>http://ghrc.nsstc.nasa.gov/uso/citation.html</URL><Description></Description>\n<Type>Citing GHRC Data</Type></OnlineResource></OnlineResources><AssociatedDIFs><DIF>\n<EntryId>A2_DySno_NRT</EntryId></DIF></AssociatedDIFs><Spatial><SpatialCoverageType>Horizontal</SpatialCoverageType><HorizontalSpatialDomain><Geometry>\n<CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle>\n<WestBoundingCoordinate>-180</WestBoundingCoordinate>\n<NorthBoundingCoordinate>90</NorthBoundingCoordinate>\n<EastBoundingCoordinate>180</EastBoundingCoordinate>\n<SouthBoundingCoordinate>-90</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain>\n<GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation></Spatial>\n<MetadataStandardName>ECHO</MetadataStandardName>\n<MetadataStandardVersion>10</MetadataStandardVersion>\n</Collection></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")

      is_flat = true
      collection.each do |key, value|
        unless value.is_a? String
          is_flat = false
        end
      end

      assert_equal(is_flat, true)
      #asserting this so that it can be shown for next test that this key is normally available
      assert_equal((collection.keys.include? "Contacts/Contact/OrganizationEmails/Email"), true)
    end

    it "removes nil values from incoming records" do
      #changed response to <OrganizationEmails>\n<Email></Email></OrganizationEmails> to represent nil value
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000020-LANCEAMSR2").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>9</took><result concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"8\" format=\"application/echo10+xml\">\n<Collection>\n<ShortName>A2_DySno_NRT</ShortName>\n<VersionId>0</VersionId>\n<InsertTime>2015-05-01T13:26:43Z</InsertTime>\n<LastUpdate>2015-09-14T13:26:43Z</LastUpdate>\n<LongName>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS</LongName>\n<DataSetId>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0</DataSetId>\n<Description>The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.</Description>\n<CollectionDataType>NEAR_REAL_TIME</CollectionDataType>\n<Orderable>false</Orderable>\n<Visible>true</Visible>\n<ProcessingLevelId>3</ProcessingLevelId>\n<ArchiveCenter>GHRC</ArchiveCenter>\n<CitationForExternalPublication>Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</CitationForExternalPublication><Price>0.0</Price><SpatialKeywords>\n<Keyword>GLOBAL</Keyword></SpatialKeywords><TemporalKeywords>\n<Keyword>DAILY</Keyword></TemporalKeywords><Temporal><RangeDateTime>\n<BeginningDateTime>2015-05-01T00:00:00Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact>\n<Role>GHRC USER SERVICES</Role><OrganizationEmails>\n<Email></Email></OrganizationEmails></Contact></Contacts><ScienceKeywords><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>CRYOSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>TERRESTRIAL HYDROSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform>\n<ShortName>GCOM-W1</ShortName>\n<LongName>GCOM-W1</LongName>\n<Type>SATELLITE</Type><Instruments><Instrument>\n<ShortName>AMSR2</ShortName><Sensors><Sensor>\n<ShortName>AMSR2</ShortName></Sensor></Sensors></Instrument></Instruments></Platform></Platforms>\n<AdditionalAttributes>\n<AdditionalAttribute>\n<Name>identifier_product_doi</Name>\n<DataType>STRING</DataType>\n<Description>product DOI</Description>\n<Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n</AdditionalAttribute>\n<AdditionalAttribute>\n<Name>identifier_product_doi_authority</Name>\n<DataType>STRING</DataType>\n<Description>DOI authority</Description>\n<Value>http://dx.doi.org</Value>\n</AdditionalAttribute>\n</AdditionalAttributes>\n<Campaigns><Campaign>\n<ShortName>LANCE</ShortName></Campaign></Campaigns><OnlineAccessURLs><OnlineAccessURL>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><URLDescription></URLDescription><MimeType></MimeType></OnlineAccessURL></OnlineAccessURLs><OnlineResources><OnlineResource>\n<URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><Description></Description>\n<Type>Alternate Data Access</Type></OnlineResource><OnlineResource>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/</URL><Description></Description>\n<Type>Browse</Type></OnlineResource><OnlineResource>\n<URL>https://worldview.earthdata.nasa.gov/</URL><Description></Description>\n<Type>Worldview Imagery</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/</URL><Description></Description>\n<Type>Homepage</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf</URL><Description></Description>\n<Type>Guide</Type></OnlineResource><OnlineResource>\n<URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL><Description></Description>\n<Type>DOI</Type></OnlineResource><OnlineResource>\n<URL>http://ghrc.nsstc.nasa.gov/uso/citation.html</URL><Description></Description>\n<Type>Citing GHRC Data</Type></OnlineResource></OnlineResources><AssociatedDIFs><DIF>\n<EntryId>A2_DySno_NRT</EntryId></DIF></AssociatedDIFs><Spatial><SpatialCoverageType>Horizontal</SpatialCoverageType><HorizontalSpatialDomain><Geometry>\n<CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle>\n<WestBoundingCoordinate>-180</WestBoundingCoordinate>\n<NorthBoundingCoordinate>90</NorthBoundingCoordinate>\n<EastBoundingCoordinate>180</EastBoundingCoordinate>\n<SouthBoundingCoordinate>-90</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain>\n<GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation></Spatial>\n<MetadataStandardName>ECHO</MetadataStandardName>\n<MetadataStandardVersion>10</MetadataStandardVersion>\n</Collection></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")
      assert_equal((collection.keys.include? "Contacts/Contact/OrganizationEmails/Email"), false)
    end

    it "adds in required fields when nil" do
      #changed shortname to be == nil and shortname is always required
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?concept_id=C1000000020-LANCEAMSR2").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>9</took><result concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"8\" format=\"application/echo10+xml\">\n<Collection>\n<ShortName></ShortName>\n<VersionId>0</VersionId>\n<InsertTime>2015-05-01T13:26:43Z</InsertTime>\n<LastUpdate>2015-09-14T13:26:43Z</LastUpdate>\n<LongName>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS</LongName>\n<DataSetId>NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0</DataSetId>\n<Description>The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.</Description>\n<CollectionDataType>NEAR_REAL_TIME</CollectionDataType>\n<Orderable>false</Orderable>\n<Visible>true</Visible>\n<ProcessingLevelId>3</ProcessingLevelId>\n<ArchiveCenter>GHRC</ArchiveCenter>\n<CitationForExternalPublication>Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</CitationForExternalPublication><Price>0.0</Price><SpatialKeywords>\n<Keyword>GLOBAL</Keyword></SpatialKeywords><TemporalKeywords>\n<Keyword>DAILY</Keyword></TemporalKeywords><Temporal><RangeDateTime>\n<BeginningDateTime>2015-05-01T00:00:00Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact>\n<Role>GHRC USER SERVICES</Role><OrganizationEmails>\n<Email>ghrc-dmg@itsc.uah.edu</Email></OrganizationEmails></Contact></Contacts><ScienceKeywords><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>CRYOSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword>\n<CategoryKeyword>EARTH SCIENCE</CategoryKeyword>\n<TopicKeyword>TERRESTRIAL HYDROSPHERE</TopicKeyword>\n<TermKeyword>SNOW/ICE</TermKeyword><VariableLevel1Keyword>\n<Value>SNOW WATER EQUIVALENT</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform>\n<ShortName>GCOM-W1</ShortName>\n<LongName>GCOM-W1</LongName>\n<Type>SATELLITE</Type><Instruments><Instrument>\n<ShortName>AMSR2</ShortName><Sensors><Sensor>\n<ShortName>AMSR2</ShortName></Sensor></Sensors></Instrument></Instruments></Platform></Platforms>\n<AdditionalAttributes>\n<AdditionalAttribute>\n<Name>identifier_product_doi</Name>\n<DataType>STRING</DataType>\n<Description>product DOI</Description>\n<Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n</AdditionalAttribute>\n<AdditionalAttribute>\n<Name>identifier_product_doi_authority</Name>\n<DataType>STRING</DataType>\n<Description>DOI authority</Description>\n<Value>http://dx.doi.org</Value>\n</AdditionalAttribute>\n</AdditionalAttributes>\n<Campaigns><Campaign>\n<ShortName>LANCE</ShortName></Campaign></Campaigns><OnlineAccessURLs><OnlineAccessURL>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><URLDescription></URLDescription><MimeType></MimeType></OnlineAccessURL></OnlineAccessURLs><OnlineResources><OnlineResource>\n<URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/</URL><Description></Description>\n<Type>Alternate Data Access</Type></OnlineResource><OnlineResource>\n<URL>https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/</URL><Description></Description>\n<Type>Browse</Type></OnlineResource><OnlineResource>\n<URL>https://worldview.earthdata.nasa.gov/</URL><Description></Description>\n<Type>Worldview Imagery</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/</URL><Description></Description>\n<Type>Homepage</Type></OnlineResource><OnlineResource>\n<URL>http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf</URL><Description></Description>\n<Type>Guide</Type></OnlineResource><OnlineResource>\n<URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL><Description></Description>\n<Type>DOI</Type></OnlineResource><OnlineResource>\n<URL>http://ghrc.nsstc.nasa.gov/uso/citation.html</URL><Description></Description>\n<Type>Citing GHRC Data</Type></OnlineResource></OnlineResources><AssociatedDIFs><DIF>\n<EntryId>A2_DySno_NRT</EntryId></DIF></AssociatedDIFs><Spatial><SpatialCoverageType>Horizontal</SpatialCoverageType><HorizontalSpatialDomain><Geometry>\n<CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle>\n<WestBoundingCoordinate>-180</WestBoundingCoordinate>\n<NorthBoundingCoordinate>90</NorthBoundingCoordinate>\n<EastBoundingCoordinate>180</EastBoundingCoordinate>\n<SouthBoundingCoordinate>-90</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain>\n<GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation></Spatial>\n<MetadataStandardName>ECHO</MetadataStandardName>\n<MetadataStandardVersion>10</MetadataStandardVersion>\n</Collection></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")
      
      #same hardcoded result as unedited Cmr request, except with shortname changed to ""
      assert_equal(collection, {"CollectionState"=>"", "VersionId"=>"0", "InsertTime"=>"2015-05-01T13:26:43Z", "LastUpdate"=>"2015-09-14T13:26:43Z", "LongName"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS", "DataSetId"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0", "Description"=>"The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.", "CollectionDataType"=>"NEAR_REAL_TIME", "Orderable"=>"false", "Visible"=>"true", "ProcessingLevelId"=>"3", "ArchiveCenter"=>"GHRC", "CitationForExternalPublication"=>"Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "Price"=>"0.0", "SpatialKeywords/Keyword"=>"GLOBAL", "TemporalKeywords/Keyword"=>"DAILY", "Temporal/RangeDateTime/BeginningDateTime"=>"2015-05-01T00:00:00Z", "Contacts/Contact/Role"=>"GHRC USER SERVICES", "Contacts/Contact/OrganizationEmails/Email"=>"ghrc-dmg@itsc.uah.edu", "ScienceKeywords/ScienceKeyword0/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword0/TopicKeyword"=>"CRYOSPHERE", "ScienceKeywords/ScienceKeyword0/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword0/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "ScienceKeywords/ScienceKeyword1/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword1/TopicKeyword"=>"TERRESTRIAL HYDROSPHERE", "ScienceKeywords/ScienceKeyword1/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword1/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "Platforms/Platform/ShortName"=>"GCOM-W1", "Platforms/Platform/LongName"=>"GCOM-W1", "Platforms/Platform/Type"=>"SATELLITE", "Platforms/Platform/Instruments/Instrument/ShortName"=>"AMSR2", "Platforms/Platform/Instruments/Instrument/Sensors/Sensor/ShortName"=>"AMSR2", "AdditionalAttributes/AdditionalAttribute0/Name"=>"identifier_product_doi", "AdditionalAttributes/AdditionalAttribute0/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute0/Description"=>"product DOI", "AdditionalAttributes/AdditionalAttribute0/Value"=>"10.5067/AMSR2/A2_DySno_NRT", "AdditionalAttributes/AdditionalAttribute1/Name"=>"identifier_product_doi_authority", "AdditionalAttributes/AdditionalAttribute1/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute1/Description"=>"DOI authority", "AdditionalAttributes/AdditionalAttribute1/Value"=>"http://dx.doi.org", "Campaigns/Campaign/ShortName"=>"LANCE", "OnlineAccessURLs/OnlineAccessURL/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/URL"=>"https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/Type"=>"Alternate Data Access", "OnlineResources/OnlineResource1/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/", "OnlineResources/OnlineResource1/Type"=>"Browse", "OnlineResources/OnlineResource2/URL"=>"https://worldview.earthdata.nasa.gov/", "OnlineResources/OnlineResource2/Type"=>"Worldview Imagery", "OnlineResources/OnlineResource3/URL"=>"http://lance.nsstc.nasa.gov/", "OnlineResources/OnlineResource3/Type"=>"Homepage", "OnlineResources/OnlineResource4/URL"=>"http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf", "OnlineResources/OnlineResource4/Type"=>"Guide", "OnlineResources/OnlineResource5/URL"=>"http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "OnlineResources/OnlineResource5/Type"=>"DOI", "OnlineResources/OnlineResource6/URL"=>"http://ghrc.nsstc.nasa.gov/uso/citation.html", "OnlineResources/OnlineResource6/Type"=>"Citing GHRC Data", "AssociatedDIFs/DIF/EntryId"=>"A2_DySno_NRT", "Spatial/SpatialCoverageType"=>"Horizontal", "Spatial/HorizontalSpatialDomain/Geometry/CoordinateSystem"=>"CARTESIAN", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/WestBoundingCoordinate"=>"-180", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/NorthBoundingCoordinate"=>"90", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/EastBoundingCoordinate"=>"180", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/SouthBoundingCoordinate"=>"-90", "Spatial/GranuleSpatialRepresentation"=>"CARTESIAN", "MetadataStandardName"=>"ECHO", "MetadataStandardVersion"=>"10", "ShortName"=>"", "DataFormat"=>""})      
    end

    it "correctly adds in the dependent fields" do
      #In this stub I removed all entries for the Spatial/HorizontalSpatialDomain/Geometry
      #A bounding rectangle is expected to be added in since all collections need one type of bounding geometry
      stub_request(:get, DEPENDENT_URL).with(:headers => DEFAULT_STUB_HEADERS).to_return(:status => 200, :body => DEPENDENT_BODY, :headers => DEPENDENT_HEADER)
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")
      
      #same hardcoded result as unedited Cmr request, except with the 4 bounding coordinates added in
      assert_equal(collection, {"CollectionState"=>"", "VersionId"=>"0", "InsertTime"=>"2015-05-01T13:26:43Z", "LastUpdate"=>"2015-09-14T13:26:43Z", "LongName"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS", "DataSetId"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0", "Description"=>"The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.", "CollectionDataType"=>"NEAR_REAL_TIME", "Orderable"=>"false", "Visible"=>"true", "ProcessingLevelId"=>"3", "ArchiveCenter"=>"GHRC", "CitationForExternalPublication"=>"Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "Price"=>"0.0", "SpatialKeywords/Keyword"=>"GLOBAL", "TemporalKeywords/Keyword"=>"DAILY", "Temporal/RangeDateTime/BeginningDateTime"=>"2015-05-01T00:00:00Z", "Contacts/Contact/Role"=>"GHRC USER SERVICES", "Contacts/Contact/OrganizationEmails/Email"=>"ghrc-dmg@itsc.uah.edu", "ScienceKeywords/ScienceKeyword0/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword0/TopicKeyword"=>"CRYOSPHERE", "ScienceKeywords/ScienceKeyword0/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword0/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "ScienceKeywords/ScienceKeyword1/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword1/TopicKeyword"=>"TERRESTRIAL HYDROSPHERE", "ScienceKeywords/ScienceKeyword1/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword1/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "Platforms/Platform/ShortName"=>"GCOM-W1", "Platforms/Platform/LongName"=>"GCOM-W1", "Platforms/Platform/Type"=>"SATELLITE", "Platforms/Platform/Instruments/Instrument/ShortName"=>"AMSR2", "Platforms/Platform/Instruments/Instrument/Sensors/Sensor/ShortName"=>"AMSR2", "AdditionalAttributes/AdditionalAttribute0/Name"=>"identifier_product_doi", "AdditionalAttributes/AdditionalAttribute0/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute0/Description"=>"product DOI", "AdditionalAttributes/AdditionalAttribute0/Value"=>"10.5067/AMSR2/A2_DySno_NRT", "AdditionalAttributes/AdditionalAttribute1/Name"=>"identifier_product_doi_authority", "AdditionalAttributes/AdditionalAttribute1/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute1/Description"=>"DOI authority", "AdditionalAttributes/AdditionalAttribute1/Value"=>"http://dx.doi.org", "Campaigns/Campaign/ShortName"=>"LANCE", "OnlineAccessURLs/OnlineAccessURL/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/URL"=>"https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/Type"=>"Alternate Data Access", "OnlineResources/OnlineResource1/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/", "OnlineResources/OnlineResource1/Type"=>"Browse", "OnlineResources/OnlineResource2/URL"=>"https://worldview.earthdata.nasa.gov/", "OnlineResources/OnlineResource2/Type"=>"Worldview Imagery", "OnlineResources/OnlineResource3/URL"=>"http://lance.nsstc.nasa.gov/", "OnlineResources/OnlineResource3/Type"=>"Homepage", "OnlineResources/OnlineResource4/URL"=>"http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf", "OnlineResources/OnlineResource4/Type"=>"Guide", "OnlineResources/OnlineResource5/URL"=>"http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "OnlineResources/OnlineResource5/Type"=>"DOI", "OnlineResources/OnlineResource6/URL"=>"http://ghrc.nsstc.nasa.gov/uso/citation.html", "OnlineResources/OnlineResource6/Type"=>"Citing GHRC Data", "AssociatedDIFs/DIF/EntryId"=>"A2_DySno_NRT", "Spatial/SpatialCoverageType"=>"Horizontal", "Spatial/HorizontalSpatialDomain/Geometry/CoordinateSystem"=>"CARTESIAN", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/WestBoundingCoordinate"=>"", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/NorthBoundingCoordinate"=>"", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/EastBoundingCoordinate"=>"", "Spatial/HorizontalSpatialDomain/Geometry/BoundingRectangle/SouthBoundingCoordinate"=>"", "Spatial/GranuleSpatialRepresentation"=>"CARTESIAN", "MetadataStandardName"=>"ECHO", "MetadataStandardVersion"=>"10", "ShortName"=>"Test_ShortName", "DataFormat"=>""})
    end

    it "does not overwrite dependent fields when alternative is present" do
      #In this stub I added a bounding point instead of a bounding rectangle
      #The system should recognize that a bounding point is a suitable alternative to rectangle
      #and not add a rectangle or overwrite the point results.
      stub_request(:get, OVERWRITE_DEPENDENT_URL).with(:headers => DEFAULT_STUB_HEADERS).to_return(:status => 200, :body => OVERWRITE_DEPENDENT_BODY, :headers => OVERWRITE_DEPENDENT_HEADER)
      collection = Cmr.get_collection("C1000000020-LANCEAMSR2")
      
      #same hardcoded result as unedited Cmr request, no data should be changed, because point is valid
      assert_equal(collection, {"CollectionState"=>"", "VersionId"=>"0", "InsertTime"=>"2015-05-01T13:26:43Z", "LastUpdate"=>"2015-09-14T13:26:43Z", "LongName"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS", "DataSetId"=>"NRT AMSR2 DAILY L3 GLOBAL SNOW WATER EQUIVALENT EASE-GRIDS V0", "Description"=>"The Advanced Microwave Scanning Radiometer 2 (AMSR2) instrument on the Global Change Observation Mission - Water 1 (GCOM-W1) provides global passive microwave measurements of terrestrial, oceanic, and atmospheric parameters for the investigation of global water and energy cycles.  Near real-time (NRT) products are generated within 3 hours of the last observations in the file, by the Land Atmosphere Near real-time Capability for EOS (LANCE) at the AMSR Science Investigator-led Processing System (AMSR SIPS), which is collocated with the Global Hydrology Resource Center (GHRC) DAAC.  The GCOM-W1 AMSR2 Level-3 Snow Water Equivalent (SWE) data set contains snow water equivalent (SWE) data and quality assurance flags mapped to Northern and Southern Hemisphere 25 km Equal-Area Scalable Earth Grids (EASE-Grids).  Data are stored in HDF-EOS5 format and are available via HTTP from the EOSDIS LANCE system at https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/.  If data latency is not a primary concern, please consider using science quality products.  Science products are created using the best available ancillary, calibration and ephemeris information.  Science quality products are an internally consistent, well-calibrated record of the Earth's geophysical properties to support science.  The AMSR SIPS plans to start producing initial AMSR2 standard science quality data products in late 2015 and they will be available from the NSIDC DAAC.  Notice: All LANCE AMSR2 data should be used with the understanding that these are preliminary products.  Cross calibration with AMSR-E products has not been performed.  As updates are made to the L1R data set, those changes will be reflected in this higher level product.", "CollectionDataType"=>"NEAR_REAL_TIME", "Orderable"=>"false", "Visible"=>"true", "ProcessingLevelId"=>"3", "ArchiveCenter"=>"GHRC", "CitationForExternalPublication"=>"Tedesco, M., J. Jeyaratnam, and R. Kelly. 2015. NRT AMSR2 Daily L3 Global Snow Water Equivalent EASE-Grids [indicate subset used]. Dataset available online, [https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/] from NASA LANCE AMSR2 at the GHRC DAAC Huntsville, Alabama, U.S.A. doi: http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "Price"=>"0.0", "SpatialKeywords/Keyword"=>"GLOBAL", "TemporalKeywords/Keyword"=>"DAILY", "Temporal/RangeDateTime/BeginningDateTime"=>"2015-05-01T00:00:00Z", "Contacts/Contact/Role"=>"GHRC USER SERVICES", "Contacts/Contact/OrganizationEmails/Email"=>"ghrc-dmg@itsc.uah.edu", "ScienceKeywords/ScienceKeyword0/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword0/TopicKeyword"=>"CRYOSPHERE", "ScienceKeywords/ScienceKeyword0/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword0/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "ScienceKeywords/ScienceKeyword1/CategoryKeyword"=>"EARTH SCIENCE", "ScienceKeywords/ScienceKeyword1/TopicKeyword"=>"TERRESTRIAL HYDROSPHERE", "ScienceKeywords/ScienceKeyword1/TermKeyword"=>"SNOW/ICE", "ScienceKeywords/ScienceKeyword1/VariableLevel1Keyword/Value"=>"SNOW WATER EQUIVALENT", "Platforms/Platform/ShortName"=>"GCOM-W1", "Platforms/Platform/LongName"=>"GCOM-W1", "Platforms/Platform/Type"=>"SATELLITE", "Platforms/Platform/Instruments/Instrument/ShortName"=>"AMSR2", "Platforms/Platform/Instruments/Instrument/Sensors/Sensor/ShortName"=>"AMSR2", "AdditionalAttributes/AdditionalAttribute0/Name"=>"identifier_product_doi", "AdditionalAttributes/AdditionalAttribute0/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute0/Description"=>"product DOI", "AdditionalAttributes/AdditionalAttribute0/Value"=>"10.5067/AMSR2/A2_DySno_NRT", "AdditionalAttributes/AdditionalAttribute1/Name"=>"identifier_product_doi_authority", "AdditionalAttributes/AdditionalAttribute1/DataType"=>"STRING", "AdditionalAttributes/AdditionalAttribute1/Description"=>"DOI authority", "AdditionalAttributes/AdditionalAttribute1/Value"=>"http://dx.doi.org", "Campaigns/Campaign/ShortName"=>"LANCE", "OnlineAccessURLs/OnlineAccessURL/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/URL"=>"https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/", "OnlineResources/OnlineResource0/Type"=>"Alternate Data Access", "OnlineResources/OnlineResource1/URL"=>"https://lance.nsstc.nasa.gov/amsr2-science/browse_png/level3/daysnow/R00/", "OnlineResources/OnlineResource1/Type"=>"Browse", "OnlineResources/OnlineResource2/URL"=>"https://worldview.earthdata.nasa.gov/", "OnlineResources/OnlineResource2/Type"=>"Worldview Imagery", "OnlineResources/OnlineResource3/URL"=>"http://lance.nsstc.nasa.gov/", "OnlineResources/OnlineResource3/Type"=>"Homepage", "OnlineResources/OnlineResource4/URL"=>"http://lance.nsstc.nasa.gov/amsr2-science/doc/LANCE_A2_DySno_NRT_dataset.pdf", "OnlineResources/OnlineResource4/Type"=>"Guide", "OnlineResources/OnlineResource5/URL"=>"http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT", "OnlineResources/OnlineResource5/Type"=>"DOI", "OnlineResources/OnlineResource6/URL"=>"http://ghrc.nsstc.nasa.gov/uso/citation.html", "OnlineResources/OnlineResource6/Type"=>"Citing GHRC Data", "AssociatedDIFs/DIF/EntryId"=>"A2_DySno_NRT", "Spatial/SpatialCoverageType"=>"Horizontal", "Spatial/HorizontalSpatialDomain/Geometry/CoordinateSystem"=>"CARTESIAN", "Spatial/HorizontalSpatialDomain/Geometry/Point/PointLongitude"=>"123", "Spatial/HorizontalSpatialDomain/Geometry/Point/PointLatitude"=>"456", "Spatial/GranuleSpatialRepresentation"=>"CARTESIAN", "MetadataStandardName"=>"ECHO", "MetadataStandardVersion"=>"10", "ShortName"=>"Test_ShortName", "DataFormat"=>""})
    end
  end


  describe "collection_granule_count" do

    it "gets number of associated granules" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/granules.echo10?concept_id=C1000000020-LANCEAMSR2&page_num=1&page_size=10").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>29</hits><took>127</took><result concept-id=\"G1369618397-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"15\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170206.he5</GranuleUR>\n      <InsertTime>2017-02-07T02:02:56Z</InsertTime>\n      <LastUpdate>2017-02-07T02:02:56Z</LastUpdate>\n      <DeleteTime>2017-02-20T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-07T02:02:56Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-06T00:18:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-07T00:07:39Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702060018_184D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170206.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170206.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369702891-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170206.he5</GranuleUR>\n      <InsertTime>2017-02-07T02:13:32Z</InsertTime>\n      <LastUpdate>2017-02-07T02:13:32Z</LastUpdate>\n      <DeleteTime>2017-02-20T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-07T02:13:32Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-06T00:18:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-07T00:07:39Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702060018_184D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170206.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170206.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369706131-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"14\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170207.he5</GranuleUR>\n      <InsertTime>2017-02-08T01:07:25Z</InsertTime>\n      <LastUpdate>2017-02-08T01:07:25Z</LastUpdate>\n      <DeleteTime>2017-02-21T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-08T01:07:25Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-07T01:03:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-07T23:12:02Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702070103_191D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170207.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170207.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369785274-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170207.he5</GranuleUR>\n      <InsertTime>2017-02-08T02:47:13Z</InsertTime>\n      <LastUpdate>2017-02-08T02:47:13Z</LastUpdate>\n      <DeleteTime>2017-02-21T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-08T02:47:13Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-07T01:03:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-07T23:12:02Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702070103_191D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170207.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170207.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369784894-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"15\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170208.he5</GranuleUR>\n      <InsertTime>2017-02-09T01:51:40Z</InsertTime>\n      <LastUpdate>2017-02-09T01:51:40Z</LastUpdate>\n      <DeleteTime>2017-02-22T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-09T01:51:40Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-08T00:06:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-08T23:55:22Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702080006_182D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170208.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170208.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369902687-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170208.he5</GranuleUR>\n      <InsertTime>2017-02-09T03:33:08Z</InsertTime>\n      <LastUpdate>2017-02-09T03:33:08Z</LastUpdate>\n      <DeleteTime>2017-02-22T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-09T03:33:08Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-08T00:06:20Z</BeginningDateTime>\n          <EndingDateTime>2017-02-08T23:55:22Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702080006_182D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170208.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170208.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1369902067-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"15\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170209.he5</GranuleUR>\n      <InsertTime>2017-02-10T02:33:51Z</InsertTime>\n      <LastUpdate>2017-02-10T02:33:51Z</LastUpdate>\n      <DeleteTime>2017-02-23T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-10T02:33:51Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-09T00:51:19Z</BeginningDateTime>\n          <EndingDateTime>2017-02-10T00:38:41Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702090051_189D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170209.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170209.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1370055026-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170209.he5</GranuleUR>\n      <InsertTime>2017-02-10T02:44:32Z</InsertTime>\n      <LastUpdate>2017-02-10T02:44:32Z</LastUpdate>\n      <DeleteTime>2017-02-23T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-10T02:44:32Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-09T00:51:19Z</BeginningDateTime>\n          <EndingDateTime>2017-02-10T00:38:41Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702090051_189D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170209.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170209.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1370057615-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"14\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_P00_20170210.he5</GranuleUR>\n      <InsertTime>2017-02-11T01:36:42Z</InsertTime>\n      <LastUpdate>2017-02-11T01:36:42Z</LastUpdate>\n      <DeleteTime>2017-02-24T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-11T01:36:42Z</ProductionDateTime>\n        <LocalVersionId>P00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-10T01:33:21Z</BeginningDateTime>\n          <EndingDateTime>2017-02-10T23:43:04Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702100133_196D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170210.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/P00/hdfeos5/AMSR_2_L3_DailySnow_P00_20170210.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result><result concept-id=\"G1370128036-LANCEAMSR2\" collection-concept-id=\"C1000000020-LANCEAMSR2\" revision-id=\"1\" format=\"application/echo10+xml\">\n    <Granule>\n      <GranuleUR>AMSR_2_L3_DailySnow_R00_20170210.he5</GranuleUR>\n      <InsertTime>2017-02-11T03:23:27Z</InsertTime>\n      <LastUpdate>2017-02-11T03:23:27Z</LastUpdate>\n      <DeleteTime>2017-02-24T23:59:59.999Z</DeleteTime>\n      <Collection>\n        <ShortName>A2_DySno_NRT</ShortName>\n        <VersionId>0</VersionId>\n      </Collection>\n      <DataGranule>\n        <DayNightFlag>BOTH</DayNightFlag>\n        <ProductionDateTime>2017-02-11T03:23:27Z</ProductionDateTime>\n        <LocalVersionId>R00</LocalVersionId>\n      </DataGranule>\n      <PGEVersionClass>\n        <PGEName>DailySnow</PGEName>\n        <PGEVersion>00</PGEVersion>\n      </PGEVersionClass>\n      <Temporal>\n        <RangeDateTime>\n          <BeginningDateTime>2017-02-10T01:33:21Z</BeginningDateTime>\n          <EndingDateTime>2017-02-10T23:43:04Z</EndingDateTime>\n        </RangeDateTime>\n      </Temporal>\n        <Spatial>\n          <HorizontalSpatialDomain>\n            <Geometry>\n              <BoundingRectangle>\n                <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>\n                <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>\n                <EastBoundingCoordinate>180.0</EastBoundingCoordinate>\n                <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>\n              </BoundingRectangle>\n            </Geometry>\n          </HorizontalSpatialDomain>\n        </Spatial>\n      <MeasuredParameters>\n        <MeasuredParameter>\n          <ParameterName>Snow Water Equivalent</ParameterName>\n        </MeasuredParameter>\n      </MeasuredParameters>\n      <AdditionalAttributes>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi</Name>\n          <Values>\n            <Value>10.5067/AMSR2/A2_DySno_NRT</Value>\n          </Values>\n        </AdditionalAttribute>\n        <AdditionalAttribute>\n          <Name>identifier_product_doi_authority</Name>\n          <Values>\n            <Value>http://dx.doi.org</Value>\n          </Values>\n        </AdditionalAttribute>\n      </AdditionalAttributes>\n      <InputGranules>\n        <InputGranule>(GW1AM2_201702100133_196D_L1SNRTBR_2220220.h5</InputGranule>\n      </InputGranules>\n      <OnlineAccessURLs>\n        <OnlineAccessURL>\n          <URL>https://lance.nsstc.nasa.gov/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170210.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (primary)</URLDescription>\n        </OnlineAccessURL>\n        <OnlineAccessURL>\n          <URL>https://lance.itsc.uah.edu/amsr2-science/data/level3/daysnow/R00/hdfeos5/AMSR_2_L3_DailySnow_R00_20170210.he5</URL>\n          <URLDescription>Online access to AMSR-2 Near-Real-Time LANCE Products (backup)</URLDescription>\n        </OnlineAccessURL>\n      </OnlineAccessURLs>\n      <OnlineResources>\n        <OnlineResource>\n          <URL>http://dx.doi.org/10.5067/AMSR2/A2_DySno_NRT</URL>\n          <Type>Data Object Identifier</Type>\n        </OnlineResource>\n      </OnlineResources>\n      <Orderable>true</Orderable>\n      <DataFormat>HDF-EOS 5</DataFormat>\n    </Granule></result></results>", :headers => {"date"=>["Mon, 20 Feb 2017 19:38:25 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["10"], "cmr-request-id"=>["436b50ec-c84a-4180-93fa-9c721087d65b"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"]})
      granule_count = Cmr.collection_granule_count("C1000000020-LANCEAMSR2")

      assert_equal(granule_count, 29)
    end

  end

  describe "collection_search" do 
    it "gets free text results from CMR" do
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?page_num=1&page_size=10&provider=NSIDCV0&provider=ORNL_DAAC&provider=LARC_ASDC&provider=LARC&provider=LAADS&provider=GES_DISC&provider=GHRC&provider=SEDAC&provider=ASF&provider=LPDAAC_ECS&provider=LANCEMODIS&provider=NSIDC_ECS&provider=OB_DAAC&provider=CDDIS&provider=LANCEAMSR2&provider=PODAAC&keyword=?*doris?*").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>24</hits><took>48</took><result concept-id=\"C1000000000-CDDIS\" revision-id=\"4\" format=\"application/echo10+xml\"><Collection>    <ShortName>CDDIS_DORIS_data_cycle</ShortName>    <VersionId>1</VersionId>    <InsertTime>2003-01-23T17:00:00</InsertTime>    <LastUpdate>2012-05-31T00:00:00</LastUpdate>    <LongName>Doppler Orbitography by Radiopositioning Integrated on Satellite Range-Rate Observation Data (cycle format) from NASA CDDIS</LongName>    <DataSetId>CDDIS_DORIS_data_cycle</DataSetId>    <Description>The Doppler Orbitography by Radiopositioning Integrated on Satellite (DORIS) was developed by the Centre National d'Etudes Spatiales (CNES) with cooperation from other French government agencies. The system was developed to provide precise orbit determination and high accuracy location of ground beacons for point positioning. DORIS is a dual-frequency Doppler system that has been included as an experiment on various space missions such as TOPEX/Poseidon, SPOT-2, -3, -4, and -5, Envisat, and Jason satellites. Unlike many other navigation systems, DORIS is based on an uplink device. The receivers are on board the satellite with the transmitters are on the ground. This creates a centralized system in which the complete set of observations is downloaded by the satellite to the ground center, from where they are distributed after editing and processing. An accurate measurment is made of the Doppler shift on radiofrequency signals emitted by the ground beacons and received on the spacecraft.</Description>    <Orderable>1</Orderable>    <Visible>1</Visible>    <ProcessingLevelId>1</ProcessingLevelId>    <ArchiveCenter>CDDIS-GSFC</ArchiveCenter>    <Temporal>        <EndsAtPresentFlag>true</EndsAtPresentFlag>        <RangeDateTime>            <BeginningDateTime>1990-03-31T00:00:00</BeginningDateTime>        </RangeDateTime>    </Temporal>        <Contacts>        <Contact>            <Role>Archiver</Role>            <OrganizationName>Crustal Dynamics Data Information System</OrganizationName>            <OrganizationAddresses>                <Address>                    <StreetAddress>NASA Goddard Space Flight Center, Code 690</StreetAddress>                                    <City>Greenbelt</City>                    <StateProvince>MD</StateProvince>                    <PostalCode>20771</PostalCode>                    <Country>USA</Country>                </Address>            </OrganizationAddresses>            <OrganizationPhones>                <Phone>                    <Number>301-614-6542</Number>                    <Type>Telephone</Type>                </Phone>                <Phone>                    <Number>301-614-6015</Number>                    <Type>Fax</Type>                </Phone>            </OrganizationPhones>            <OrganizationEmails>                <Email>Carey.E.Noll@nasa.gov</Email>            </OrganizationEmails>            <ContactPersons>                <ContactPerson>                    <FirstName>Carey</FirstName>                    <LastName>Noll</LastName>                </ContactPerson>            </ContactPersons>        </Contact>    </Contacts>            <Platforms>        <Platform>            <ShortName>CRYOSAT-2</ShortName>            <LongName>CryoSat-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>GROUND STATIONS</ShortName>            <LongName>Ground Stations</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS BEACON</ShortName>                </Instrument>            </Instruments>        </Platform>                         <Platform>            <ShortName>HY-2A</ShortName>            <LongName>HaiYang-2A</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>JASON-1</ShortName>            <LongName>Jason-1</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>JASON-2</ShortName>            <LongName>Jason-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-2</ShortName>            <LongName>Systeme Probatoire Pour l'Observation de la Terre-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-3</ShortName>            <LongName>Systeme Probatoire Pour l'Observation de la Terre-3</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-4</ShortName>            <LongName>Systeme Probatoire Pour l'Observation de la Terre-4</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-5</ShortName>            <LongName>Systeme Probatoire Pour l'Observation de la Terre-5</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>         <Platform>            <ShortName>TOPEX/POSEIDON</ShortName>            <LongName>Ocean Topography Experiment</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                    </Platforms>                    \t\t            <Campaigns>        <Campaign>            <ShortName>IDS</ShortName>            <LongName>International DORIS Service</LongName>        </Campaign>    </Campaigns>       <OnlineAccessURLs>        <OnlineAccessURL>            <URL>ftp://cddis.gsfc.nasa.gov/doris/data</URL>        </OnlineAccessURL>    </OnlineAccessURLs>        <AssociatedDIFs>        <DIF>            <EntryId>CDDIS_DORIS_data</EntryId>        </DIF>    </AssociatedDIFs>        <Spatial>                      <HorizontalSpatialDomain>            <Geometry>                <CoordinateSystem>CARTESIAN</CoordinateSystem>                <BoundingRectangle>                    <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>                    <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>                    <EastBoundingCoordinate>180.0</EastBoundingCoordinate>                    <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>                </BoundingRectangle>            </Geometry>        </HorizontalSpatialDomain>        <VerticalSpatialDomain>            <Type>None</Type>            <Value>None</Value>        </VerticalSpatialDomain>        <GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation>    </Spatial>        </Collection></result><result concept-id=\"C1000000001-CDDIS\" revision-id=\"4\" format=\"application/echo10+xml\"><Collection>    <ShortName>CDDIS_DORIS_data_rinex</ShortName>    <VersionId>1</VersionId>    <InsertTime>2009-04-29T17:00:00</InsertTime>    <LastUpdate>2012-05-31T00:00:00</LastUpdate>    <LongName>Doppler Orbitography by Radiopositioning Integrated on Satellite Range-Rate Observation Data (RINEX format) from NASA CDDIS</LongName>    <DataSetId>CDDIS_DORIS_data_rinex</DataSetId>    <Description>The Doppler Orbitography by Radiopositioning Integrated on Satellite (DORIS) was developed by the Centre National d'Etudes Spatiales (CNES) with cooperation from other French government agencies. The system was developed to provide precise orbit determination and high accuracy location of ground beacons for point positioning. DORIS is a dual-frequency Doppler system that has been included as an experiment on various space missions such as TOPEX/Poseidon, SPOT-2, -3, -4, and -5, Envisat, and Jason satellites. Unlike many other navigation systems, DORIS is based on an uplink device. The receivers are on board the satellite with the transmitters are on the ground. This creates a centralized system in which the complete set of observations is downloaded by the satellite to the ground center, from where they are distributed after editing and processing. An accurate measurment is made of the Doppler shift on radiofrequency signals emitted by the ground beacons and received on the spacecraft.</Description>    <Orderable>1</Orderable>    <Visible>1</Visible>    <ProcessingLevelId>1</ProcessingLevelId>    <ArchiveCenter>CDDIS</ArchiveCenter>    <Temporal>        <EndsAtPresentFlag>true</EndsAtPresentFlag>        <RangeDateTime>            <BeginningDateTime>2008-06-20T00:00:00</BeginningDateTime>        </RangeDateTime>    </Temporal>        <Contacts>        <Contact>            <Role>Archiver</Role>            <OrganizationName>Crustal Dynamics Data Information System</OrganizationName>            <OrganizationAddresses>                <Address>                    <StreetAddress>NASA Goddard Space Flight Center, Code 690</StreetAddress>                                    <City>Greenbelt</City>                    <StateProvince>MD</StateProvince>                    <PostalCode>20771</PostalCode>                    <Country>USA</Country>                </Address>            </OrganizationAddresses>            <OrganizationPhones>                <Phone>                    <Number>301-614-6542</Number>                    <Type>Telephone</Type>                </Phone>                <Phone>                    <Number>301-614-6015</Number>                    <Type>Fax</Type>                </Phone>            </OrganizationPhones>            <OrganizationEmails>                <Email>Carey.E.Noll@nasa.gov</Email>            </OrganizationEmails>            <ContactPersons>                <ContactPerson>                    <FirstName>Carey</FirstName>                    <LastName>Noll</LastName>                </ContactPerson>            </ContactPersons>        </Contact>    </Contacts>    \t        <Platforms>        <Platform>            <ShortName>CRYOSAT-2</ShortName>            <LongName>CryoSat-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>GROUND STATIONS</ShortName>            <LongName>Ground Stations</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS BEACON</ShortName>                </Instrument>            </Instruments>        </Platform>                         <Platform>            <ShortName>HY-2A</ShortName>            <LongName>HaiYang-2A</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                       <Platform>            <ShortName>JASON-2</ShortName>            <LongName>Jason-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>    </Platforms>            <Campaigns>        <Campaign>            <ShortName>IDS</ShortName>            <LongName>International DORIS Service</LongName>        </Campaign>    </Campaigns>       <OnlineAccessURLs>        <OnlineAccessURL>            <URL>ftp://cddis.gsfc.nasa.gov/doris/data</URL>        </OnlineAccessURL>    </OnlineAccessURLs>        <Spatial>                      <HorizontalSpatialDomain>            <Geometry>                <CoordinateSystem>CARTESIAN</CoordinateSystem>                <BoundingRectangle>                    <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>                    <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>                    <EastBoundingCoordinate>180.0</EastBoundingCoordinate>                    <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>                </BoundingRectangle>            </Geometry>        </HorizontalSpatialDomain>        <VerticalSpatialDomain>            <Type>None</Type>            <Value>None</Value>        </VerticalSpatialDomain>        <GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation>    </Spatial>        </Collection></result><result concept-id=\"C1000000020-CDDIS\" revision-id=\"4\" format=\"application/echo10+xml\"><Collection>    <ShortName>CDDIS_DORIS_products_positions</ShortName>    <VersionId>1</VersionId>    <InsertTime>2003-01-24T17:00:00</InsertTime>    <LastUpdate>2012-06-14T00:00:00</LastUpdate>    <LongName>Doppler Orbitography by Radiopositioning Integrated on Satellite Time Series of Station Positions/Velocities Product from NASA CDDIS</LongName>    <DataSetId>CDDIS_DORIS_products_positions</DataSetId>    <Description>Station position and velocity solutions (weekly and cumulative) in Software INdependent EXchange (SINEX) format derived from analysis of Doppler Orbitography by Radiopositioning Integrated on Satellite (DORIS) data. The solutions include daily values of Earth Orientation Parameters (EOPs). These products are the generated by analysis centers in support of the International DORIS Service (IDS). Time series of station coordinate solutions in Station Coordinate Difference (STCD) are also generated by the IDS analysis centers. Weekly solutions represent the IDS contribution to the International Terrestrial Reference Frame (ITRF) determination.</Description>    <Orderable>1</Orderable>    <Visible>1</Visible>    <ProcessingLevelId>2</ProcessingLevelId>    <ArchiveCenter>CDDIS</ArchiveCenter>    <Temporal>        <EndsAtPresentFlag>true</EndsAtPresentFlag>        <RangeDateTime>            <BeginningDateTime>1990-03-31T00:00:00</BeginningDateTime>        </RangeDateTime>    </Temporal>        <Contacts>        <Contact>            <Role>Archiver</Role>            <OrganizationName>Crustal Dynamics Data Information System</OrganizationName>            <OrganizationAddresses>                <Address>                    <StreetAddress>NASA Goddard Space Flight Center, Code 690</StreetAddress>                                    <City>Greenbelt</City>                    <StateProvince>MD</StateProvince>                    <PostalCode>20771</PostalCode>                    <Country>USA</Country>                </Address>            </OrganizationAddresses>            <OrganizationPhones>                <Phone>                    <Number>301-614-6542</Number>                    <Type>Telephone</Type>                </Phone>                <Phone>                    <Number>301-614-6015</Number>                    <Type>Fax</Type>                </Phone>            </OrganizationPhones>            <OrganizationEmails>                <Email>Carey.E.Noll@nasa.gov</Email>            </OrganizationEmails>            <ContactPersons>                <ContactPerson>                    <FirstName>Carey</FirstName>                    <LastName>Noll</LastName>                </ContactPerson>            </ContactPersons>        </Contact>    </Contacts>    \t        <Platforms>        <Platform>            <ShortName>CRYOSAT-2</ShortName>            <LongName>CryoSat-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>GROUND STATIONS</ShortName>            <LongName>Ground Stations</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS BEACON</ShortName>                </Instrument>            </Instruments>        </Platform>                         <Platform>            <ShortName>HY-2A</ShortName>            <LongName>HaiYang-2A</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>JASON-1</ShortName>            <LongName>Jason-1</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>JASON-2</ShortName>            <LongName>Jason-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-2</ShortName>            <LongName>Systeme Probatoire Pour l'Observation de la Terre-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-3</ShortName>            <LongName>Systeme Probatoire Pour l'Observation de la Terre-3</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-4</ShortName>            <LongName>Systeme Probatoire Pour l'Observation de la Terre-4</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-5</ShortName>            <LongName>Systeme Probatoire Pour l'Observation de la Terre-5</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>         <Platform>            <ShortName>TOPEX/POSEIDON</ShortName>            <LongName>Ocean Topography Experiment</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                    </Platforms>            <Campaigns>        <Campaign>            <ShortName>IDS</ShortName>            <LongName>International DORIS Service</LongName>        </Campaign>    </Campaigns>       <OnlineAccessURLs>        <OnlineAccessURL>            <URL>ftp://cddis.gsfc.nasa.gov/doris/products</URL>        </OnlineAccessURL>    </OnlineAccessURLs>            <AssociatedDIFs>        <DIF>            <EntryId>CDDIS_DORIS_data</EntryId>        </DIF>    </AssociatedDIFs>    <Spatial>                      <HorizontalSpatialDomain>            <Geometry>                <CoordinateSystem>CARTESIAN</CoordinateSystem>                <BoundingRectangle>                    <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>                    <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>                    <EastBoundingCoordinate>180.0</EastBoundingCoordinate>                    <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>                </BoundingRectangle>            </Geometry>        </HorizontalSpatialDomain>        <VerticalSpatialDomain>            <Type>None</Type>            <Value>None</Value>        </VerticalSpatialDomain>        <GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation>    </Spatial>        </Collection></result><result concept-id=\"C1000000005-CDDIS\" revision-id=\"4\" format=\"application/echo10+xml\"><Collection>    <ShortName>CDDIS_DORIS_products_quaternions</ShortName>    <VersionId>1</VersionId>    <InsertTime>2009-11-13T17:00:00</InsertTime>    <LastUpdate>2012-06-14T00:00:00</LastUpdate>    <LongName>Doppler Orbitography by Radiopositioning Integrated on Satellite Quaternions from NASA CDDIS</LongName>    <DataSetId>CDDIS_DORIS_products_quaternions</DataSetId>    <Description>Satellite attitude information from satellites with Doppler Orbitography by Radiopositioning Integrated on Satellite (DORIS) receivers. Files include attitude quaternions for the body of the spacecraft and solar panel angular positions.</Description>    <Orderable>1</Orderable>    <Visible>1</Visible>    <ProcessingLevelId>1</ProcessingLevelId>    <ArchiveCenter>CDDIS</ArchiveCenter>    <Temporal>        <EndsAtPresentFlag>true</EndsAtPresentFlag>        <RangeDateTime>            <BeginningDateTime>2001-04-30T00:00:00</BeginningDateTime>        </RangeDateTime>    </Temporal>        <Contacts>        <Contact>            <Role>Archiver</Role>            <OrganizationName>Crustal Dynamics Data Information System</OrganizationName>            <OrganizationAddresses>                <Address>                    <StreetAddress>NASA Goddard Space Flight Center, Code 690</StreetAddress>                                    <City>Greenbelt</City>                    <StateProvince>MD</StateProvince>                    <PostalCode>20771</PostalCode>                    <Country>USA</Country>                </Address>            </OrganizationAddresses>            <OrganizationPhones>                <Phone>                    <Number>301-614-6542</Number>                    <Type>Telephone</Type>                </Phone>                <Phone>                    <Number>301-614-6015</Number>                    <Type>Fax</Type>                </Phone>            </OrganizationPhones>            <OrganizationEmails>                <Email>Carey.E.Noll@nasa.gov</Email>            </OrganizationEmails>            <ContactPersons>                <ContactPerson>                    <FirstName>Carey</FirstName>                    <LastName>Noll</LastName>                </ContactPerson>            </ContactPersons>        </Contact>    </Contacts>    \t        <Platforms>              <Platform>            <ShortName>JASON-1</ShortName>            <LongName>Jason-1</LongName>            <Type>UNKNOWN</Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>JASON-2</ShortName>            <LongName>Jason-2</LongName>            <Type>UNKNOWN</Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>    </Platforms>            <Campaigns>        <Campaign>            <ShortName>IDS</ShortName>            <LongName>International DORIS Service</LongName>        </Campaign>    </Campaigns>       <OnlineAccessURLs>        <OnlineAccessURL>            <URL>ftp://cddis.gsfc.nasa.gov/doris/ancillary/quaternions</URL>        </OnlineAccessURL>    </OnlineAccessURLs>            <AssociatedDIFs>        <DIF>            <EntryId>CDDIS_DORIS_data</EntryId>        </DIF>    </AssociatedDIFs>    <Spatial>                      <HorizontalSpatialDomain>            <Geometry>                <CoordinateSystem>CARTESIAN</CoordinateSystem>                <BoundingRectangle>                    <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>                    <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>                    <EastBoundingCoordinate>180.0</EastBoundingCoordinate>                    <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>                </BoundingRectangle>            </Geometry>        </HorizontalSpatialDomain>        <VerticalSpatialDomain>            <Type>None</Type>            <Value>None</Value>        </VerticalSpatialDomain>        <GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation>    </Spatial>        </Collection></result><result concept-id=\"C1000000080-CDDIS\" revision-id=\"4\" format=\"application/echo10+xml\"><Collection>    <ShortName>CDDIS_DORIS_products_stcd</ShortName>    <VersionId>1</VersionId>    <InsertTime>2003-01-24T17:00:00</InsertTime>    <LastUpdate>2012-05-31T00:00:00</LastUpdate>    <LongName>DORIS AC Time Series of Station Coordinates Product</LongName>    <DataSetId>CDDIS_DORIS_products_stcd</DataSetId>    <Description>Station position time series solutions in DORIS Station Coordinate Difference (STCD) format derived from analysis of Doppler Orbitography by Radiopositioning Integrated on Satellite (DORIS) data. These products are the generated by analysis centers in support of the International DORIS Service (IDS).</Description>    <Orderable>1</Orderable>    <Visible>1</Visible>    <ProcessingLevelId>2</ProcessingLevelId>    <ArchiveCenter>CDDIS</ArchiveCenter>    <Temporal>        <EndsAtPresentFlag>true</EndsAtPresentFlag>        <RangeDateTime>            <BeginningDateTime>1990-03-31T00:00:00</BeginningDateTime>        </RangeDateTime>    </Temporal>        <Contacts>        <Contact>            <Role>Archiver</Role>            <OrganizationName>Crustal Dynamics Data Information System</OrganizationName>            <OrganizationAddresses>                <Address>                    <StreetAddress>NASA Goddard Space Flight Center, Code 690</StreetAddress>                                    <City>Greenbelt</City>                    <StateProvince>MD</StateProvince>                    <PostalCode>20771</PostalCode>                    <Country>USA</Country>                </Address>            </OrganizationAddresses>            <OrganizationPhones>                <Phone>                    <Number>301-614-6542</Number>                    <Type>Telephone</Type>                </Phone>                <Phone>                    <Number>301-614-6015</Number>                    <Type>Fax</Type>                </Phone>            </OrganizationPhones>            <OrganizationEmails>                <Email>Carey.E.Noll@nasa.gov</Email>            </OrganizationEmails>            <ContactPersons>                <ContactPerson>                    <FirstName>Carey</FirstName>                    <LastName>Noll</LastName>                </ContactPerson>            </ContactPersons>        </Contact>    </Contacts>    \t    <Platforms>            <Platform>            <ShortName>SPOT-2</ShortName>            <LongName>SPOT-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-3</ShortName>            <LongName>SPOT-3</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-4</ShortName>            <LongName>SPOT-4</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>SPOT-5</ShortName>            <LongName>SPOT-5</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>              <Platform>            <ShortName>JASON-1</ShortName>            <LongName>Jason-1</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>TOPEX/POSEIDON</ShortName>            <LongName>TOPEX/POSEIDON</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>              <Platform>            <ShortName>CRYOSAT-2</ShortName>            <LongName>CryoSat-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                <Platform>            <ShortName>GROUND STATIONS</ShortName>            <LongName>Ground Stations</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS BEACON</ShortName>                </Instrument>            </Instruments>        </Platform>                         <Platform>            <ShortName>HY-2A</ShortName>            <LongName>HaiYang-2A</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>                       <Platform>            <ShortName>JASON-2</ShortName>            <LongName>Jason-2</LongName>            <Type> </Type>                        <Instruments>                <Instrument>                    <ShortName>DORIS RECEIVER</ShortName>                </Instrument>            </Instruments>        </Platform>    </Platforms>                <Campaigns>        <Campaign>            <ShortName>IDS</ShortName>            <LongName>International DORIS Service</LongName>        </Campaign>    </Campaigns>       <OnlineAccessURLs>        <OnlineAccessURL>            <URL>ftp://cddis.gsfc.nasa.gov/doris/products/</URL>        </OnlineAccessURL>    </OnlineAccessURLs>        <Spatial>                      <HorizontalSpatialDomain>            <Geometry>                <CoordinateSystem>CARTESIAN</CoordinateSystem>                <BoundingRectangle>                    <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>                    <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>                    <EastBoundingCoordinate>180.0</EastBoundingCoordinate>                    <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>                </BoundingRectangle>            </Geometry>        </HorizontalSpatialDomain>        <VerticalSpatialDomain>            <Type>None</Type>            <Value>None</Value>        </VerticalSpatialDomain>        <GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation>    </Spatial>        </Collection></result><result concept-id=\"C1000000002-CDDIS\" revision-id=\"4\" format=\"application/echo10+xml\"><Collection>    <ShortName>CDDIS_DORIS_products_geocenter</ShortName>    <VersionId>1</VersionId>    <InsertTime>2003-01-24T17:00:00</InsertTime>    <LastUpdate>2012-05-31T00:00:00</LastUpdate>    <LongName>Doppler Orbitography by Radiopositioning Integrated on Satellite Time Series of Geocenter Product from NASA CDDIS</LongName>    <DataSetId>CDDIS_DORIS_products_geocenter</DataSetId>    <Description>Geocenter determination solutions derived from analysis of  Doppler Orbitography by Radiopositioning Integrated on Satellite (DORIS) data. These products are the generated by analysis centers in support of the International DORIS Service (IDS).</Description>    <Orderable>1</Orderable>    <Visible>1</Visible>    <ProcessingLevelId>2</ProcessingLevelId>    <ArchiveCenter>CDDIS</ArchiveCenter>    <Temporal>        <EndsAtPresentFlag>true</EndsAtPresentFlag>        <RangeDateTime>            <BeginningDateTime>1990-03-31T00:00:00</BeginningDateTime>        </RangeDateTime>    </Temporal>        <Contacts>        <Contact>            <Role>Archiver</Role>            <OrganizationName>Crustal Dynamics Data Information System</OrganizationName>            <OrganizationAddresses>                <Address>                    <StreetAddress>NASA Goddard Space Flight Center, Code 690</StreetAddress>                                    <City>Greenbelt</City>                    <StateProvince>MD</StateProvince>                    <PostalCode>20771</PostalCode>                    <Country>USA</Country>                </Address>            </OrganizationAddresses>            <OrganizationPhones>                <Phone>                    <Number>301-614-6542</Number>                    <Type>Telephone</Type>                </Phone>                <Phone>                    <Number>301-614-6015</Number>                    <Type>Fax</Type>                </Phone>            </OrganizationPhones>            <OrganizationEmails>                <Email>Carey.E.Noll@nasa.gov</Email>            </OrganizationEmails>            <ContactPersons>                <ContactPerson>                    <FirstName>Carey</FirstName>                    <LastName>Noll</LastName>                </ContactPerson>            </ContactPersons>        </Contact>    </Contacts>    \t                    <Campaigns>        <Campaign>            <ShortName>IDS</ShortName>            <LongName>International DORIS Service</LongName>        </Campaign>    </Campaigns>       <OnlineAccessURLs>        <OnlineAccessURL>            <URL>ftp://cddis.gsfc.nasa.gov/doris/products/geoc</URL>        </OnlineAccessURL>    </OnlineAccessURLs>        <Spatial>                      <HorizontalSpatialDomain>            <Geometry>                <CoordinateSystem>CARTESIAN</CoordinateSystem>                <BoundingRectangle>                    <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>                    <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>                    <EastBoundingCoordinate>180.0</EastBoundingCoordinate>                    <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>                </BoundingRectangle>            </Geometry>        </HorizontalSpatialDomain>        <VerticalSpatialDomain>            <Type>None</Type>            <Value>None</Value>        </VerticalSpatialDomain>        <GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation>    </Spatial>        </Collection></result><result concept-id=\"C1000000003-CDDIS\" revision-id=\"4\" format=\"application/echo10+xml\"><Collection>    <ShortName>CDDIS_DORIS_products_ionosphere</ShortName>    <VersionId>1</VersionId>    <InsertTime>2003-01-17T17:00:00</InsertTime>    <LastUpdate>2012-06-14T00:00:00</LastUpdate>    <LongName>Doppler Orbitography by Radiopositioning Integrated on Satellite Ionosphere Product from NASA CDDIS</LongName>    <DataSetId>CDDIS_DORIS_products_ionosphere</DataSetId>    <Description>Ionosphere correction values derived from analysis of Doppler Orbitography by Radiopositioning Integrated on Satellite (DORIS) data. These products are the generated by analysis centers in support of the International DORIS Service (IDS).</Description>    <Orderable>1</Orderable>    <Visible>1</Visible>    <ProcessingLevelId>2</ProcessingLevelId>    <ArchiveCenter>CDDIS</ArchiveCenter>    <Temporal>        <EndsAtPresentFlag>true</EndsAtPresentFlag>        <RangeDateTime>            <BeginningDateTime>2001-01-01T00:00:00</BeginningDateTime>        </RangeDateTime>    </Temporal>        <Contacts>        <Contact>            <Role>Archiver</Role>            <OrganizationName>Crustal Dynamics Data Information System</OrganizationName>            <OrganizationAddresses>                <Address>                    <StreetAddress>NASA Goddard Space Flight Center, Code 690</StreetAddress>                                    <City>Greenbelt</City>                    <StateProvince>MD</StateProvince>                    <PostalCode>20771</PostalCode>                    <Country>USA</Country>                </Address>            </OrganizationAddresses>            <OrganizationPhones>                <Phone>                    <Number>301-614-6542</Number>                    <Type>Telephone</Type>                </Phone>                <Phone>                    <Number>301-614-6015</Number>                    <Type>Fax</Type>                </Phone>            </OrganizationPhones>            <OrganizationEmails>                <Email>Carey.E.Noll@nasa.gov</Email>            </OrganizationEmails>            <ContactPersons>                <ContactPerson>                    <FirstName>Carey</FirstName>                    <LastName>Noll</LastName>                </ContactPerson>            </ContactPersons>        </Contact>    </Contacts>    \t                    <Campaigns>        <Campaign>            <ShortName>IDS</ShortName>            <LongName>International DORIS Service</LongName>        </Campaign>    </Campaigns>       <OnlineAccessURLs>        <OnlineAccessURL>            <URL>ftp://cddis.gsfc.nasa.gov/doris/products/iono</URL>        </OnlineAccessURL>    </OnlineAccessURLs>        <Spatial>                      <HorizontalSpatialDomain>            <Geometry>                <CoordinateSystem>CARTESIAN</CoordinateSystem>                <BoundingRectangle>                    <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>                    <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>                    <EastBoundingCoordinate>180.0</EastBoundingCoordinate>                    <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>                </BoundingRectangle>            </Geometry>        </HorizontalSpatialDomain>        <VerticalSpatialDomain>            <Type>None</Type>            <Value>None</Value>        </VerticalSpatialDomain>        <GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation>    </Spatial>        </Collection></result><result concept-id=\"C1000000004-CDDIS\" revision-id=\"4\" format=\"application/echo10+xml\"><Collection>    <ShortName>CDDIS_DORIS_products_orbit</ShortName>    <VersionId>1</VersionId>    <InsertTime>2007-09-12T17:00:00</InsertTime>    <LastUpdate>2012-06-14T00:00:00</LastUpdate>    <LongName>Doppler Orbitography by Radiopositioning Integrated on Satellite Orbits Product from NASA CDDIS</LongName>    <DataSetId>CDDIS_DORIS_products_orbit</DataSetId>    <Description>Precise satellite orbits derived from analysis of Doppler Orbitography by Radiopositioning Integrated on Satellite (DORIS) data. These products are the generated by analysis centers in support of the International DORIS Service (IDS).</Description>    <Orderable>1</Orderable>    <Visible>1</Visible>    <ProcessingLevelId>2</ProcessingLevelId>    <ArchiveCenter>CDDIS</ArchiveCenter>    <Temporal>        <EndsAtPresentFlag>true</EndsAtPresentFlag>        <RangeDateTime>            <BeginningDateTime>1992-11-04T00:00:00</BeginningDateTime>        </RangeDateTime>    </Temporal>        <Contacts>        <Contact>            <Role>Archiver</Role>            <OrganizationName>Crustal Dynamics Data Information System</OrganizationName>            <OrganizationAddresses>                <Address>                    <StreetAddress>NASA Goddard Space Flight Center, Code 690</StreetAddress>                                    <City>Greenbelt</City>                    <StateProvince>MD</StateProvince>                    <PostalCode>20771</PostalCode>                    <Country>USA</Country>                </Address>            </OrganizationAddresses>            <OrganizationPhones>                <Phone>                    <Number>301-614-6542</Number>                    <Type>Telephone</Type>                </Phone>                <Phone>                    <Number>301-614-6015</Number>                    <Type>Fax</Type>                </Phone>            </OrganizationPhones>            <OrganizationEmails>                <Email>Carey.E.Noll@nasa.gov</Email>            </OrganizationEmails>            <ContactPersons>                <ContactPerson>                    <FirstName>Carey</FirstName>                    <LastName>Noll</LastName>                </ContactPerson>            </ContactPersons>        </Contact>    </Contacts>    \t                    <Campaigns>        <Campaign>            <ShortName>IDS</ShortName>            <LongName>International DORIS Service</LongName>        </Campaign>    </Campaigns>       <OnlineAccessURLs>        <OnlineAccessURL>            <URL>ftp://cddis.gsfc.nasa.gov/doris/products/orbits</URL>        </OnlineAccessURL>    </OnlineAccessURLs>        <AssociatedDIFs>        <DIF>            <EntryId>CDDIS_DORIS_data</EntryId>        </DIF>    </AssociatedDIFs>        <Spatial>                      <HorizontalSpatialDomain>            <Geometry>                <CoordinateSystem>CARTESIAN</CoordinateSystem>                <BoundingRectangle>                    <WestBoundingCoordinate>-180.0</WestBoundingCoordinate>                    <NorthBoundingCoordinate>90.0</NorthBoundingCoordinate>                    <EastBoundingCoordinate>180.0</EastBoundingCoordinate>                    <SouthBoundingCoordinate>-90.0</SouthBoundingCoordinate>                </BoundingRectangle>            </Geometry>        </HorizontalSpatialDomain>        <VerticalSpatialDomain>            <Type>None</Type>            <Value>None</Value>        </VerticalSpatialDomain>        <GranuleSpatialRepresentation>CARTESIAN</GranuleSpatialRepresentation>    </Spatial>        </Collection></result><result concept-id=\"C1214585472-SCIOPS\" revision-id=\"1\" format=\"application/echo10+xml\"><Collection><ShortName>GDR-Ms</ShortName><VersionId>Not provided</VersionId><InsertTime>1970-01-01T00:00:00</InsertTime><LastUpdate>1970-01-01T00:00:00</LastUpdate><LongName>Not provided</LongName><DataSetId>TOPEX/POSEIDON Merged Geophysical Data Records</DataSetId><Description>The oceans play a fundamental role in maintaining a life-sustaining\nclimate on Earth by transporting an enormous amount of heat through\ntheir large scale circulation systems. Understanding the role that the\nocean circulation plays in climate change is the main goal of the\nTOPEX/POSEIDON mission, a cooperative project between the United\nStates' National Aeronautics and Space Administration (NASA) and the\nFrench Space Agency, Centre National d'Etudes Spatiales (CNES).\nTOPEX/POSEIDON uses advanced satellite radar altimetry, a microwave\nradiometer and very precise tracking systems (DORIS, laser\nretroreflector and an experimental GPS receiver) to make very precise\nand accurate observations of sea level -altimeter accuracy better than\n2 centimeters, orbit accuracy better than 3 centimeters- for three\n(nominally) to five (expected) years. The orbit, satellite bus and\npayload instruments are optimized to measure sea level, to map\nbasin-wide variations of currents, and to monitor the effects of the\ncurrents such as the Gulf Stream, on global climate change. Altimeter\nmeasurements also allow scientists to study ocean tides and waves,\nmarine geophysics and winds.\n\nLaunched by Ariane on August 10, 1992, TOPEX/POSEIDON is a core\nelement of the international World Ocean Circulation Experiment (WOCE)\nand Tropical Ocean and Global Atmosphere (TOGA) measurement\nprograms. Analysis of the satellite altimetry data, together with WOCE\nand TOGA ocean measurements, yields major advances in our quantitative\nunderstanding of the ocean circulation and its climate. TOPEX/POSEIDON\nlays the foundation for long term ocean monitoring from space.  The\nTOPEX/POSEIDON satellite observe the Earth from 66 North to 66 South\nlatitude at an altitude of 1330 kilometers. It allows to observe 90%\nof the ice-free oceans and all major straits. The orbit is not\nsun-synchronous and is prograde. It takes nearly 2 hours to circle the\nEarth (revolution period). The repeat-cycle is about 10 days, i.e. the\nsatellite passes vertically over the same location in a 1-kilometer\nbandwith every 10 days (or 127 revolutions). The distance between\nsuccessive tracks is on the order of 315 kilometers at the Equator.\n\nThe TOPEX/POSEIDON Merged Geophysical Data Records (GDR-Ms) are\nproduced by AVISO and JPL/PODAAC to reinforce unity of the\nTOPEX/POSEIDON mission.  They combine measurements from two radar\naltimeters which share the same antenna, the NASA dual frequency (Ku\nand C bands) instrument similar to the GEOSAT altimeter and the CNES\nproof-of-concept solid state altimeter (Ku band). The GDR-Ms are\ndistributed on CD ROMs (ISO 9660).  Each CD ROM contains two ten-day\nrepeat-cycles of data : Merged GDRs, crossover files and CNES and NASA\norbit epehemeris. They are swath data and no images. Waveform data are\nnot included in the GDR-Ms. It is emphasized that this product is\nconsidered research data because of the form and content of the data\n- over a hundred parameters including flags for each second of\nmeasurement. Analysis softwares are the responsibility of the\nuser. Calculation of sea surface height from the altimeter range and\nenvironmental corrections (e.g. dry and wet tropospheric corrections,\ntidal effects, electromagnetic bias) is the responsibility of the\nuser.\n\nCD-ROMs are being produced and are available as the data are\nprocessed. They are disseminated systematically to TOPEX/POSEIDON\nPrincipal Investigators and Co-Investigators. User handbooks - one for\nthe CD-ROM, one for the data products - are distributed w with the\nfirst CD-ROM.  Finally note that AVISO/altimetry data center is a\nresponse to the oceanographic user community's need for flexible\naccess to data from a range of satellites and sensors. It is devoted\nto satellite altimetry and space oceanography Earth Observation\nmissions. AVISO/Altimetry is the ocean science user's link with the\nproject teams. Within its goal, AVISO produces also on CD-ROMs\nvalue-added ocean products from the basic merged products of the\nTOPEX/POSEIDON mission to ease the users in the data processing -\nproviding validated and directly useable altimetric data.\nValue-added ocean products are indeed complementary to the basic\nproducts (e.g. the Corrected Sea Surface Heights - CORSSH - or sea\nlevel anomalies - SLA).  For more information, you can connect to\nthe AVISO World Wide Web server or contact either one of the\ninvestigators, the AVISO data center or the AVISO technical contact.</Description><Orderable>true</Orderable><Visible>true</Visible><RevisionDate>2015-12-02T00:00:00.000Z</RevisionDate><ProcessingLevelId>Not provided</ProcessingLevelId><ArchiveCenter>AVISO</ArchiveCenter><CollectionState>Not provided</CollectionState><SpatialKeywords><Keyword>GLOBAL</Keyword></SpatialKeywords><Temporal><EndsAtPresentFlag>false</EndsAtPresentFlag><RangeDateTime><BeginningDateTime>1992-09-23T00:00:00.000Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact><Role>Data Originator</Role><OrganizationName>AVISO (CNES)</OrganizationName></Contact><Contact><Role>ARCHIVER</Role><OrganizationName>AVISO</OrganizationName><ContactPersons><ContactPerson><FirstName>Not provided</FirstName><LastName>AVISO OPERATION CENTER</LastName><JobPosition>DATA CENTER CONTACT</JobPosition></ContactPerson></ContactPersons></Contact><Contact><Role>DISTRIBUTOR</Role><OrganizationName>AVISO</OrganizationName><ContactPersons><ContactPerson><FirstName>Not provided</FirstName><LastName>AVISO OPERATION CENTER</LastName><JobPosition>DATA CENTER CONTACT</JobPosition></ContactPerson></ContactPersons></Contact><Contact><Role>TECHNICAL CONTACT</Role><ContactPersons><ContactPerson><FirstName>FREDERIQUE</FirstName><LastName>BLANC</LastName><JobPosition>METADATA AUTHOR</JobPosition></ContactPerson><ContactPerson><FirstName>FREDERIQUE</FirstName><LastName>BLANC</LastName><JobPosition>INVESTIGATOR</JobPosition></ContactPerson><ContactPerson><FirstName>CATHERINE</FirstName><LastName>SCHGOUNN</LastName><JobPosition>TECHNICAL CONTACT</JobPosition></ContactPerson><ContactPerson><FirstName>PATRICK</FirstName><LastName>VINCENT</LastName><JobPosition>INVESTIGATOR</JobPosition></ContactPerson></ContactPersons></Contact></Contacts><ScienceKeywords><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>MARINE GEOPHYSICS</TermKeyword><VariableLevel1Keyword><Value>MARINE GRAVITY FIELD</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>OCEAN CIRCULATION</TermKeyword><VariableLevel1Keyword><Value>EDDIES</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>OCEAN CIRCULATION</TermKeyword><VariableLevel1Keyword><Value>FRONTS</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>OCEAN CIRCULATION</TermKeyword><VariableLevel1Keyword><Value>GYRES</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>OCEAN CIRCULATION</TermKeyword><VariableLevel1Keyword><Value>OCEAN CURRENTS</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>OCEAN WAVES</TermKeyword><VariableLevel1Keyword><Value>SIGNIFICANT WAVE HEIGHT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>OCEAN WAVES</TermKeyword><VariableLevel1Keyword><Value>WAVE HEIGHT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>SEA SURFACE TOPOGRAPHY</TermKeyword><VariableLevel1Keyword><Value>SEA SURFACE HEIGHT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>SOLID EARTH</TopicKeyword><TermKeyword>GRAVITY/GRAVITATIONAL FIELD</TermKeyword><VariableLevel1Keyword><Value>GRAVITATIONAL FIELD</Value></VariableLevel1Keyword><DetailedVariableKeyword>GEOPHYSICAL FIELDS</DetailedVariableKeyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>SOLID EARTH</TopicKeyword><TermKeyword>GRAVITY/GRAVITATIONAL FIELD</TermKeyword><VariableLevel1Keyword><Value>GRAVITY</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform><ShortName>TOPEX/POSEIDON</ShortName><LongName>Ocean Topography Experiment</LongName><Type>Not provided</Type><Instruments><Instrument><ShortName>ALT (TOPEX)</ShortName><LongName>TOPEX Radar Altimeter</LongName></Instrument><Instrument><ShortName>ALTIMETERS</ShortName></Instrument><Instrument><ShortName>SSALT</ShortName><LongName>POSEIDON Solid State Radar Altimeter</LongName></Instrument><Instrument><ShortName>LASERS</ShortName><LongName>Light Amplification by Stimulated Emission of Radiation</LongName></Instrument><Instrument><ShortName>LRA</ShortName><LongName>Laser Retroreflector Array</LongName></Instrument><Instrument><ShortName>DORIS</ShortName><LongName>Doppler Orbitography and Radiopositioning Integrated by Satellite</LongName></Instrument><Instrument><ShortName>RADIOMETERS</ShortName></Instrument><Instrument><ShortName>TMR</ShortName><LongName>TOPEX Microwave Radiometer</LongName></Instrument></Instruments></Platform></Platforms><AdditionalAttributes><AdditionalAttribute><Name>metadata.extraction_date</Name><DataType>STRING</DataType><Description>Not provided</Description><Value>2015-12-02 12:16:26</Value></AdditionalAttribute><AdditionalAttribute><Name>metadata.keyword_version</Name><DataType>FLOAT</DataType><Description>Not provided</Description><Value>8.1</Value></AdditionalAttribute></AdditionalAttributes><Campaigns><Campaign><ShortName>TOGA</ShortName><LongName>Tropical Ocean Global Atmosphere</LongName></Campaign><Campaign><ShortName>WOCE</ShortName><LongName>World Ocean Circulation Experiment</LongName></Campaign></Campaigns><OnlineResources><OnlineResource><URL>http://www.jason.oceanobs.com/html/portail/general/welcome_uk.php3</URL><Description>\n         AVISO Home page.\n      </Description><Type>UNKNOWN</Type></OnlineResource><OnlineResource><URL>http://www.jason.oceanobs.com/html/donnees/produits/gdr_uk.html</URL><Description>\n         Geophysical Data Records\n      </Description><Type>UNKNOWN</Type></OnlineResource><OnlineResource><URL>http://podaac-www.jpl.nasa.gov</URL><Description>\n         JPL Physical Oceanography Distributed Active Archive Center page\n      </Description><Type>UNKNOWN</Type></OnlineResource></OnlineResources><Spatial><SpatialCoverageType>HORIZONTAL</SpatialCoverageType><HorizontalSpatialDomain><Geometry><CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle><WestBoundingCoordinate>-180.0</WestBoundingCoordinate><NorthBoundingCoordinate>66.0</NorthBoundingCoordinate><EastBoundingCoordinate>180.0</EastBoundingCoordinate><SouthBoundingCoordinate>-66.0</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain><GranuleSpatialRepresentation>NO_SPATIAL</GranuleSpatialRepresentation></Spatial></Collection></result><result concept-id=\"C1214585066-SCIOPS\" revision-id=\"1\" format=\"application/echo10+xml\"><Collection><ShortName>POEs</ShortName><VersionId>Not provided</VersionId><InsertTime>1970-01-01T00:00:00</InsertTime><LastUpdate>1970-01-01T00:00:00</LastUpdate><LongName>Not provided</LongName><DataSetId>TOPEX/POSEIDON Precise Orbit Ephemerides</DataSetId><Description>The oceans play a fundamental role in maintaining a life-sustaining\nclimate on Earth by transporting an enormous amount of heat through\ntheir large scale circulation systems. Understanding the role that the\nocean circulation plays in climate change is the main goal of the\nTOPEX/POSEIDON mission, a cooperative project between the United\nStates' National Aeronautics and Space Administration (NASA) and the\nFrench Space Agency, Centre National d'Etudes Spatiales (CNES).\nTOPEX/POSEIDON uses advanced satellite radar altimetry, a microwave\nradiometer and very precise tracking systems (DORIS, laser\nretroreflector and an experimental GPS receiver) to make very precise\nand accurate observations of sea level -altimeter accuracy better than\n2 centimeters, orbit accuracy better than 3 centimeters- for three\n(nominally) to five (expected) years. The orbit, satellite bus and\npayload instruments are optimized to measure sea level, to map\nbasin-wide variations of currents, and to monitor the effects of the\ncurrents such as the Gulf Stream, on global climate change. Altimeter\nmeasurements also allow scientists to study ocean tides and waves,\nmarine geophysics and winds.  Launched by Ariane on August 10, 1992,\nTOPEX/POSEIDON is a core element of the international World Ocean\nCirculation Experiment (WOCE) and Tropical Ocean and Global Atmosphere\n(TOGA) measurement programs. Analysis of the satellite altimetry data,\ntogether with WOCE and TOGA ocean measurements, yields major advances\nin our quantitative understanding of the ocean circulation and its\nclimate. TOPEX/POSEIDON lays the foundation for long term ocean\nmonitoring from space.\n\nThey are TOPEX/POSEIDON Precise Orbit Ephemerides (POEs) produced by\nCNES and they are TOPEX/POSEIDON Precise Orbit Ephemerides (POEs)\nproduced by NASA. Both products are re-formatted and made available -\none file per entity - to users by AVISO and JPL/PODAAC. The POEs are\ndistributed on CD-ROMs (ISO 9660). Each CD-ROM contains two ten-day\nrepeat-cycles of data : Merged GDRs, crossover files and CNES and NASA\norbit ephemerides. They are swath data and no images. Waveform data\nare not included in the GDR-Ms.\n\nCD-ROMs are being produced and are available as the data are\nprocessed. They are disseminated systematically to TOPEX/POSEIDON\nPrincipal Investigators and Co-Investigators. User handbooks - one for\nthe CD-ROM, one for the data products - are distributed with the first\nCD-ROM.  For more information, you can connect to the AVISO World Wide\nWeb server or contact either one of the investigators, the AVISO data\ncenter or the AVISO technical contact.</Description><Orderable>true</Orderable><Visible>true</Visible><RevisionDate>2015-12-02T00:00:00.000Z</RevisionDate><ProcessingLevelId>Not provided</ProcessingLevelId><ArchiveCenter>AVISO</ArchiveCenter><CollectionState>Not provided</CollectionState><SpatialKeywords><Keyword>GLOBAL</Keyword></SpatialKeywords><Temporal><EndsAtPresentFlag>false</EndsAtPresentFlag><RangeDateTime><BeginningDateTime>1992-09-23T00:00:00.000Z</BeginningDateTime></RangeDateTime></Temporal><Contacts><Contact><Role>Data Originator</Role><OrganizationName>AVISO Altimetry (CLS)</OrganizationName></Contact><Contact><Role>ARCHIVER</Role><OrganizationName>AVISO</OrganizationName><ContactPersons><ContactPerson><FirstName>Not provided</FirstName><LastName>AVISO OPERATION CENTER</LastName><JobPosition>DATA CENTER CONTACT</JobPosition></ContactPerson></ContactPersons></Contact><Contact><Role>DISTRIBUTOR</Role><OrganizationName>AVISO</OrganizationName><ContactPersons><ContactPerson><FirstName>Not provided</FirstName><LastName>AVISO OPERATION CENTER</LastName><JobPosition>DATA CENTER CONTACT</JobPosition></ContactPerson></ContactPersons></Contact><Contact><Role>TECHNICAL CONTACT</Role><ContactPersons><ContactPerson><FirstName>FREDERIQUE</FirstName><LastName>BLANC</LastName><JobPosition>METADATA AUTHOR</JobPosition></ContactPerson><ContactPerson><FirstName>FREDERIQUE</FirstName><LastName>BLANC</LastName><JobPosition>INVESTIGATOR</JobPosition></ContactPerson><ContactPerson><FirstName>CATHERINE</FirstName><LastName>SCHGOUNN</LastName><JobPosition>TECHNICAL CONTACT</JobPosition></ContactPerson><ContactPerson><FirstName>PATRICK</FirstName><LastName>VINCENT</LastName><JobPosition>INVESTIGATOR</JobPosition></ContactPerson></ContactPersons></Contact></Contacts><ScienceKeywords><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>MARINE GEOPHYSICS</TermKeyword><VariableLevel1Keyword><Value>MARINE GRAVITY FIELD</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>OCEANS</TopicKeyword><TermKeyword>SEA SURFACE TOPOGRAPHY</TermKeyword><VariableLevel1Keyword><Value>SEA SURFACE HEIGHT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>SPECTRAL/ENGINEERING</TopicKeyword><TermKeyword>PLATFORM CHARACTERISTICS</TermKeyword><VariableLevel1Keyword><Value>ORBITAL CHARACTERISTICS</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>SOLID EARTH</TopicKeyword><TermKeyword>GRAVITY/GRAVITATIONAL FIELD</TermKeyword><VariableLevel1Keyword><Value>GRAVITATIONAL FIELD</Value></VariableLevel1Keyword><DetailedVariableKeyword>GEOPHYSICAL FIELDS</DetailedVariableKeyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>SOLID EARTH</TopicKeyword><TermKeyword>GEODETICS</TermKeyword><VariableLevel1Keyword><Value>COORDINATE REFERENCE SYSTEM</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>SOLID EARTH</TopicKeyword><TermKeyword>GRAVITY/GRAVITATIONAL FIELD</TermKeyword><VariableLevel1Keyword><Value>SATELLITE ORBITS/REVOLUTION</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform><ShortName>TOPEX/POSEIDON</ShortName><LongName>Ocean Topography Experiment</LongName><Type>Not provided</Type><Instruments><Instrument><ShortName>LASERS</ShortName><LongName>Light Amplification by Stimulated Emission of Radiation</LongName></Instrument><Instrument><ShortName>LRA</ShortName><LongName>Laser Retroreflector Array</LongName></Instrument><Instrument><ShortName>DORIS</ShortName><LongName>Doppler Orbitography and Radiopositioning Integrated by Satellite</LongName></Instrument></Instruments></Platform></Platforms><AdditionalAttributes><AdditionalAttribute><Name>metadata.extraction_date</Name><DataType>STRING</DataType><Description>Not provided</Description><Value>2015-12-02 12:16:15</Value></AdditionalAttribute><AdditionalAttribute><Name>metadata.keyword_version</Name><DataType>FLOAT</DataType><Description>Not provided</Description><Value>8.1</Value></AdditionalAttribute></AdditionalAttributes><Campaigns><Campaign><ShortName>GOOS</ShortName><LongName>Global Ocean Observing System</LongName></Campaign><Campaign><ShortName>TOGA</ShortName><LongName>Tropical Ocean Global Atmosphere</LongName></Campaign><Campaign><ShortName>WOCE</ShortName><LongName>World Ocean Circulation Experiment</LongName></Campaign></Campaigns><OnlineAccessURLs><OnlineAccessURL><URL>http://www-aviso.cnes.fr:8090/HTML/produits/fiches/fp_tp_ephe.html</URL><URLDescription>\n         AVISO data product from topex/poseidon, accurate orbit ephemeris (POE).\n      </URLDescription></OnlineAccessURL></OnlineAccessURLs><OnlineResources><OnlineResource><URL>http://www.jason.oceanobs.com/html/portail/general/welcome_uk.php3</URL><Description>\n         AVISO home page.\n      </Description><Type>UNKNOWN</Type></OnlineResource><OnlineResource><URL>http://podaac-www.jpl.nasa.gov</URL><Description>\n         JPL Physical Oceanography Distributed Active Archive Center page.\n      </Description><Type>USER SUPPORT</Type></OnlineResource></OnlineResources><Spatial><SpatialCoverageType>HORIZONTAL</SpatialCoverageType><HorizontalSpatialDomain><Geometry><CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle><WestBoundingCoordinate>-180.0</WestBoundingCoordinate><NorthBoundingCoordinate>66.0</NorthBoundingCoordinate><EastBoundingCoordinate>180.0</EastBoundingCoordinate><SouthBoundingCoordinate>-66.0</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain><GranuleSpatialRepresentation>NO_SPATIAL</GranuleSpatialRepresentation></Spatial></Collection></result></results>", :headers => {})

      search_iterator, collection_count = Cmr.collection_search("doris")

      assert_equal(search_iterator[0]["concept_id"], "C1000000000-CDDIS")
      assert_equal(search_iterator[1]["concept_id"], "C1000000001-CDDIS")
      assert_equal(collection_count, 24)
    end
  end

  describe "required_collection_field?" do
    it "positively identifies a required field from string" do
      assert_equal(true, Cmr.required_collection_field?("Platforms/Platform/Instruments/Instrument0/ShortName"))
      assert_equal(true, Cmr.required_collection_field?("ShortName"))
    end

    it "returns false for none required field strings" do
      assert_equal(false, Cmr.required_collection_field?("Platforms/Platform0/LongName"))
      #Mispelling of required field, lower case S, was a previous bug.
      assert_equal(false, Cmr.required_collection_field?("DatasetId"))
    end
  end

  describe "total_collection_count" do
    it "get the total number of collections from CMR" do

      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.echo10?page_size=1&provider=NSIDCV0&provider=ORNL_DAAC&provider=LARC_ASDC&provider=LARC&provider=LAADS&provider=GES_DISC&provider=GHRC&provider=SEDAC&provider=ASF&provider=LPDAAC_ECS&provider=LANCEMODIS&provider=NSIDC_ECS&provider=OB_DAAC&provider=CDDIS&provider=LANCEAMSR2&provider=PODAAC").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => '<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>6381</hits><took>33</took><result></result></results>', :headers => {"date"=>["Fri, 24 Mar 2017 15:36:33 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["32728"], "cmr-took"=>["33"], "cmr-request-id"=>["8633b6cd-cc02-4147-91b2-e0236fd1b72a"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"], "strict-transport-security"=>["max-age=31536000"]})

      total_num = Cmr.total_collection_count
      assert_equal(total_num, 6381)
    end
  end

  describe "update_collections" do 
    it "returns the list of added records" do
      tester = User.find_by_email("abaker@element84.com")

      # mocking the updated list
      stub_request(:get, /collections.xml\?page_num\=1\&page_size\=2000\&updated_since\=[0-9]{4}-[0-9]{2}-[0-9]{2}T00\:00\:00.000Z/).with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => '<results><hits>151</hits><took>10</took><references><reference><name>All-India Monsoon Rainfall Index at LDEO/IRI Climate Data Library</name><id>C1214614350-SCIOPS</id><location>https://cmr.earthdata.nasa.gov:443/search/concepts/C1214614350-SCIOPS/6</location><revision-id>6</revision-id></reference><reference><name>Annual Mean Global CO2 Growth</name><id>C1214377525-SCIOPS</id><location>https://cmr.earthdata.nasa.gov:443/search/concepts/C1214377525-SCIOPS/2</location><revision-id>2</revision-id></reference></references></results>', :headers => {"date"=>["Fri, 17 Mar 2017 19:00:27 GMT"], "content-type"=>["application/xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["151"], "cmr-took"=>["24"], "cmr-request-id"=>["7348fbe8-5ef4-417e-969f-01024e4d9ef6"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"], "strict-transport-security"=>["max-age=31536000"]})
      raw_response = Cmr.collections_updated_since("2017-03-16")
      #collections in raw response 
      #[{"concept_id"=>"C1214614350-SCIOPS", "revision_id"=>"6"}, {"concept_id"=>"C1214377525-SCIOPS", "revision_id"=>"2"}]
      temp_collection = Collection.new(concept_id: "C1214614350-SCIOPS")
      temp_collection.save
      old_record = Record.new(recordable: temp_collection, revision_id: "5")
      old_record.save
      stub_request(:get, /https\:\/\/cmr.earthdata.nasa.gov\/search\/collections\.(echo10|native)\?concept_id\=C1214614350\-SCIOPS/).with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>105</took><result concept-id=\"C1214614350-SCIOPS\" revision-id=\"6\" format=\"application/echo10+xml\"><Collection><ShortName>LDEO_INDICES_INDIA</ShortName><VersionId>Not provided</VersionId><InsertTime>1970-01-01T00:00:00</InsertTime><LastUpdate>1970-01-01T00:00:00</LastUpdate><LongName>Not provided</LongName><DataSetId>All-India Monsoon Rainfall Index at LDEO/IRI Climate Data Library</DataSetId><Description>An all-India summer monsoon rainfall series for the instrumental\nperiod of 1844-1991 has been constructed using a progressively\nincreasing station density to 1870, and one that is fixed thereafter\nat a uniformly distributed 36 stations. The statistical scheme\naccounts for the increasing variance contributed to the all-India\nseries by the increasing number of stations during the period\n1844-1870. An interesting outcome of this study is that a reliable\nestimate of summer monsoon rainfall over India can be obtained using\nonly 36 observations.</Description><Orderable>true</Orderable><Visible>true</Visible><RevisionDate>2017-03-16T00:00:00.000Z</RevisionDate><ProcessingLevelId>Not provided</ProcessingLevelId><ArchiveCenter>COLUMBIA/LDEO/IRI/CDL</ArchiveCenter><CollectionState>COMPLETE</CollectionState><SpatialKeywords><Keyword>INDIA</Keyword></SpatialKeywords><TemporalKeywords><Keyword>monthly summer</Keyword></TemporalKeywords><Temporal><EndsAtPresentFlag>false</EndsAtPresentFlag><RangeDateTime><BeginningDateTime>1813-06-01T00:00:00.000Z</BeginningDateTime><EndingDateTime>1998-09-30T23:59:59.999Z</EndingDateTime></RangeDateTime></Temporal><Contacts><Contact><Role>Data Originator</Role><OrganizationName>NASA/GISS</OrganizationName></Contact><Contact><Role>ARCHIVER</Role><OrganizationName>COLUMBIA/LDEO/IRI/CDL</OrganizationName><ContactPersons><ContactPerson><FirstName>BENNO</FirstName><LastName>BLUMENTHAL</LastName><JobPosition>DATA CENTER CONTACT</JobPosition></ContactPerson></ContactPersons></Contact><Contact><Role>DISTRIBUTOR</Role><OrganizationName>COLUMBIA/LDEO/IRI/CDL</OrganizationName><ContactPersons><ContactPerson><FirstName>BENNO</FirstName><LastName>BLUMENTHAL</LastName><JobPosition>DATA CENTER CONTACT</JobPosition></ContactPerson></ContactPersons></Contact></Contacts><ScienceKeywords><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>ATMOSPHERE</TopicKeyword><TermKeyword>PRECIPITATION</TermKeyword><VariableLevel1Keyword><Value>LIQUID PRECIPITATION</Value><VariableLevel2Keyword><Value>RAIN</Value></VariableLevel2Keyword></VariableLevel1Keyword><DetailedVariableKeyword>RAINFALL</DetailedVariableKeyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>ATMOSPHERE</TopicKeyword><TermKeyword>PRECIPITATION</TermKeyword><VariableLevel1Keyword><Value>PRECIPITATION AMOUNT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>ATMOSPHERE</TopicKeyword><TermKeyword>PRECIPITATION</TermKeyword><VariableLevel1Keyword><Value>PRECIPITATION ANOMALIES</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>ATMOSPHERE</TopicKeyword><TermKeyword>WEATHER EVENTS</TermKeyword><VariableLevel1Keyword><Value>MONSOONS</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform><ShortName>Not provided</ShortName><LongName>Not provided</LongName><Type>Not provided</Type></Platform></Platforms><AdditionalAttributes><AdditionalAttribute><Name>metadata.extraction_date</Name><DataType>STRING</DataType><Description>Not provided</Description><Value>2015-12-02 13:04:05</Value></AdditionalAttribute><AdditionalAttribute><Name>metadata.keyword_version</Name><DataType>FLOAT</DataType><Description>Not provided</Description><Value>8.1</Value></AdditionalAttribute></AdditionalAttributes><CollectionAssociations><CollectionAssociation><ShortName>LDEO_INDICES</ShortName><VersionId>Not provided</VersionId><CollectionType>Not provided</CollectionType></CollectionAssociation></CollectionAssociations><Campaigns><Campaign><ShortName>DODS</ShortName><LongName>Distributed Oceanographic Data System</LongName></Campaign><Campaign><ShortName>ESIP</ShortName><LongName>Earth Science Information Partners Program</LongName></Campaign><Campaign><ShortName>OPENDAP</ShortName><LongName>Open-source Project for a Network Data Access Protocol</LongName></Campaign></Campaigns><OnlineResources><OnlineResource><URL>http://ingrid.ldeo.columbia.edu/SOURCES/.Indices/.india/</URL><Description>All-India summer monsoon rainfall index</Description><Type>USER SUPPORT</Type></OnlineResource></OnlineResources><Spatial><SpatialCoverageType>HORIZONTAL</SpatialCoverageType><HorizontalSpatialDomain><Geometry><CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle><WestBoundingCoordinate>70.0</WestBoundingCoordinate><NorthBoundingCoordinate>40.0</NorthBoundingCoordinate><EastBoundingCoordinate>90.0</EastBoundingCoordinate><SouthBoundingCoordinate>-10.0</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain><GranuleSpatialRepresentation>NO_SPATIAL</GranuleSpatialRepresentation></Spatial></Collection></result></results>", :headers => {"date"=>["Fri, 17 Mar 2017 20:00:54 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["107"], "cmr-request-id"=>["308d3b81-b229-4593-a05e-c61a741d45be"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"], "strict-transport-security"=>["max-age=31536000"]})

      #stubbing the new format check
      stub_request(:get, /https\:\/\/cmr.earthdata.nasa.gov\/search\/collections\.atom\?concept_id\=C1214614350\-SCIOPS/).with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><feed xmlns:os=\"http://a9.com/-/spec/opensearch/1.1/\" xmlns:georss=\"http://www.georss.org/georss/10\" xmlns=\"http://www.w3.org/2005/Atom\" xmlns:dc=\"http://purl.org/dc/terms/\" xmlns:echo=\"http://www.echo.nasa.gov/esip\" xmlns:esipdiscovery=\"http://commons.esipfed.org/ns/discovery/1.2/\" xmlns:gml=\"http://www.opengis.net/gml\" esipdiscovery:version=\"1.2\" xmlns:time=\"http://a9.com/-/opensearch/extensions/time/1.0/\"><entry><echo:originalFormat>ECHO10</echo:originalFormat></entry></feed>", :headers => {"date"=>["Fri, 17 Mar 2017 20:00:54 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["107"], "cmr-request-id"=>["308d3b81-b229-4593-a05e-c61a741d45be"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"], "strict-transport-security"=>["max-age=31536000"]})

      total_added = Cmr.update_collections(tester)

      assert_equal(total_added, [["C1214614350-SCIOPS", "6"]])

    end
  end

  describe "collections_updated_since" do 
    it "pulls xml response from cmr and returns hash" do
      #mocking the updated list with a small representative sample result
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.xml?page_num=1&page_size=2000&updated_since=2017-03-16T00:00:00.000Z").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => '<results><hits>151</hits><took>10</took><references><reference><name>All-India Monsoon Rainfall Index at LDEO/IRI Climate Data Library</name><id>C1214614350-SCIOPS</id><location>https://cmr.earthdata.nasa.gov:443/search/concepts/C1214614350-SCIOPS/6</location><revision-id>6</revision-id></reference><reference><name>Annual Mean Global CO2 Growth</name><id>C1214377525-SCIOPS</id><location>https://cmr.earthdata.nasa.gov:443/search/concepts/C1214377525-SCIOPS/2</location><revision-id>2</revision-id></reference></references></results>', :headers => {"date"=>["Fri, 17 Mar 2017 19:00:27 GMT"], "content-type"=>["application/xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["151"], "cmr-took"=>["24"], "cmr-request-id"=>["7348fbe8-5ef4-417e-969f-01024e4d9ef6"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"], "strict-transport-security"=>["max-age=31536000"]})

      raw_results = Cmr.collections_updated_since("2017-03-16")
      assert_equal(raw_results, {"results"=>{"hits"=>"151", "took"=>"10", "references"=>{"reference"=>[{"name"=>"All-India Monsoon Rainfall Index at LDEO/IRI Climate Data Library", "id"=>"C1214614350-SCIOPS", "location"=>"https://cmr.earthdata.nasa.gov:443/search/concepts/C1214614350-SCIOPS/6", "revision_id"=>"6"}, {"name"=>"Annual Mean Global CO2 Growth", "id"=>"C1214377525-SCIOPS", "location"=>"https://cmr.earthdata.nasa.gov:443/search/concepts/C1214377525-SCIOPS/2", "revision_id"=>"2"}]}}})
    end
  end

  describe "process_updated_collections" do 
    it "finds out of date revisions and adds the new one" do
      tester = User.find_by_email("abaker@element84.com")

      # mocking the updated list
      stub_request(:get, "https://cmr.earthdata.nasa.gov/search/collections.xml?page_num=1&page_size=2000&updated_since=2017-03-16T00:00:00.000Z").with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => '<results><hits>151</hits><took>10</took><references><reference><name>All-India Monsoon Rainfall Index at LDEO/IRI Climate Data Library</name><id>C1214614350-SCIOPS</id><location>https://cmr.earthdata.nasa.gov:443/search/concepts/C1214614350-SCIOPS/6</location><revision-id>6</revision-id></reference><reference><name>Annual Mean Global CO2 Growth</name><id>C1214377525-SCIOPS</id><location>https://cmr.earthdata.nasa.gov:443/search/concepts/C1214377525-SCIOPS/2</location><revision-id>2</revision-id></reference></references></results>', :headers => {"date"=>["Fri, 17 Mar 2017 19:00:27 GMT"], "content-type"=>["application/xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["151"], "cmr-took"=>["24"], "cmr-request-id"=>["7348fbe8-5ef4-417e-969f-01024e4d9ef6"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"], "strict-transport-security"=>["max-age=31536000"]})
      raw_response = Cmr.collections_updated_since("2017-03-16")
      #collections in raw response 
      #[{"concept_id"=>"C1214614350-SCIOPS", "revision_id"=>"6"}, {"concept_id"=>"C1214377525-SCIOPS", "revision_id"=>"2"}]
      temp_collection = Collection.new(concept_id: "C1214614350-SCIOPS")
      temp_collection.save
      old_record = Record.new(recordable: temp_collection, revision_id: "5")
      old_record.save

      stub_request(:get, /https\:\/\/cmr.earthdata.nasa.gov\/search\/collections\.(echo10|native)\?concept_id\=C1214614350\-SCIOPS/).with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><results><hits>1</hits><took>105</took><result concept-id=\"C1214614350-SCIOPS\" revision-id=\"6\" format=\"application/echo10+xml\"><Collection><ShortName>LDEO_INDICES_INDIA</ShortName><VersionId>Not provided</VersionId><InsertTime>1970-01-01T00:00:00</InsertTime><LastUpdate>1970-01-01T00:00:00</LastUpdate><LongName>Not provided</LongName><DataSetId>All-India Monsoon Rainfall Index at LDEO/IRI Climate Data Library</DataSetId><Description>An all-India summer monsoon rainfall series for the instrumental\nperiod of 1844-1991 has been constructed using a progressively\nincreasing station density to 1870, and one that is fixed thereafter\nat a uniformly distributed 36 stations. The statistical scheme\naccounts for the increasing variance contributed to the all-India\nseries by the increasing number of stations during the period\n1844-1870. An interesting outcome of this study is that a reliable\nestimate of summer monsoon rainfall over India can be obtained using\nonly 36 observations.</Description><Orderable>true</Orderable><Visible>true</Visible><RevisionDate>2017-03-16T00:00:00.000Z</RevisionDate><ProcessingLevelId>Not provided</ProcessingLevelId><ArchiveCenter>COLUMBIA/LDEO/IRI/CDL</ArchiveCenter><CollectionState>COMPLETE</CollectionState><SpatialKeywords><Keyword>INDIA</Keyword></SpatialKeywords><TemporalKeywords><Keyword>monthly summer</Keyword></TemporalKeywords><Temporal><EndsAtPresentFlag>false</EndsAtPresentFlag><RangeDateTime><BeginningDateTime>1813-06-01T00:00:00.000Z</BeginningDateTime><EndingDateTime>1998-09-30T23:59:59.999Z</EndingDateTime></RangeDateTime></Temporal><Contacts><Contact><Role>Data Originator</Role><OrganizationName>NASA/GISS</OrganizationName></Contact><Contact><Role>ARCHIVER</Role><OrganizationName>COLUMBIA/LDEO/IRI/CDL</OrganizationName><ContactPersons><ContactPerson><FirstName>BENNO</FirstName><LastName>BLUMENTHAL</LastName><JobPosition>DATA CENTER CONTACT</JobPosition></ContactPerson></ContactPersons></Contact><Contact><Role>DISTRIBUTOR</Role><OrganizationName>COLUMBIA/LDEO/IRI/CDL</OrganizationName><ContactPersons><ContactPerson><FirstName>BENNO</FirstName><LastName>BLUMENTHAL</LastName><JobPosition>DATA CENTER CONTACT</JobPosition></ContactPerson></ContactPersons></Contact></Contacts><ScienceKeywords><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>ATMOSPHERE</TopicKeyword><TermKeyword>PRECIPITATION</TermKeyword><VariableLevel1Keyword><Value>LIQUID PRECIPITATION</Value><VariableLevel2Keyword><Value>RAIN</Value></VariableLevel2Keyword></VariableLevel1Keyword><DetailedVariableKeyword>RAINFALL</DetailedVariableKeyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>ATMOSPHERE</TopicKeyword><TermKeyword>PRECIPITATION</TermKeyword><VariableLevel1Keyword><Value>PRECIPITATION AMOUNT</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>ATMOSPHERE</TopicKeyword><TermKeyword>PRECIPITATION</TermKeyword><VariableLevel1Keyword><Value>PRECIPITATION ANOMALIES</Value></VariableLevel1Keyword></ScienceKeyword><ScienceKeyword><CategoryKeyword>EARTH SCIENCE</CategoryKeyword><TopicKeyword>ATMOSPHERE</TopicKeyword><TermKeyword>WEATHER EVENTS</TermKeyword><VariableLevel1Keyword><Value>MONSOONS</Value></VariableLevel1Keyword></ScienceKeyword></ScienceKeywords><Platforms><Platform><ShortName>Not provided</ShortName><LongName>Not provided</LongName><Type>Not provided</Type></Platform></Platforms><AdditionalAttributes><AdditionalAttribute><Name>metadata.extraction_date</Name><DataType>STRING</DataType><Description>Not provided</Description><Value>2015-12-02 13:04:05</Value></AdditionalAttribute><AdditionalAttribute><Name>metadata.keyword_version</Name><DataType>FLOAT</DataType><Description>Not provided</Description><Value>8.1</Value></AdditionalAttribute></AdditionalAttributes><CollectionAssociations><CollectionAssociation><ShortName>LDEO_INDICES</ShortName><VersionId>Not provided</VersionId><CollectionType>Not provided</CollectionType></CollectionAssociation></CollectionAssociations><Campaigns><Campaign><ShortName>DODS</ShortName><LongName>Distributed Oceanographic Data System</LongName></Campaign><Campaign><ShortName>ESIP</ShortName><LongName>Earth Science Information Partners Program</LongName></Campaign><Campaign><ShortName>OPENDAP</ShortName><LongName>Open-source Project for a Network Data Access Protocol</LongName></Campaign></Campaigns><OnlineResources><OnlineResource><URL>http://ingrid.ldeo.columbia.edu/SOURCES/.Indices/.india/</URL><Description>All-India summer monsoon rainfall index</Description><Type>USER SUPPORT</Type></OnlineResource></OnlineResources><Spatial><SpatialCoverageType>HORIZONTAL</SpatialCoverageType><HorizontalSpatialDomain><Geometry><CoordinateSystem>CARTESIAN</CoordinateSystem><BoundingRectangle><WestBoundingCoordinate>70.0</WestBoundingCoordinate><NorthBoundingCoordinate>40.0</NorthBoundingCoordinate><EastBoundingCoordinate>90.0</EastBoundingCoordinate><SouthBoundingCoordinate>-10.0</SouthBoundingCoordinate></BoundingRectangle></Geometry></HorizontalSpatialDomain><GranuleSpatialRepresentation>NO_SPATIAL</GranuleSpatialRepresentation></Spatial></Collection></result></results>", :headers => {"date"=>["Fri, 17 Mar 2017 20:00:54 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["107"], "cmr-request-id"=>["308d3b81-b229-4593-a05e-c61a741d45be"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"], "strict-transport-security"=>["max-age=31536000"]})

      #stubbing the new format check
      stub_request(:get, /https\:\/\/cmr.earthdata.nasa.gov\/search\/collections\.atom\?concept_id\=C1214614350\-SCIOPS/).with(:headers => {'Accept'=>'*/*', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'User-Agent'=>'Ruby'}).to_return(:status => 200, :body => "<?xml version=\"1.0\" encoding=\"UTF-8\"?><feed xmlns:os=\"http://a9.com/-/spec/opensearch/1.1/\" xmlns:georss=\"http://www.georss.org/georss/10\" xmlns=\"http://www.w3.org/2005/Atom\" xmlns:dc=\"http://purl.org/dc/terms/\" xmlns:echo=\"http://www.echo.nasa.gov/esip\" xmlns:esipdiscovery=\"http://commons.esipfed.org/ns/discovery/1.2/\" xmlns:gml=\"http://www.opengis.net/gml\" esipdiscovery:version=\"1.2\" xmlns:time=\"http://a9.com/-/opensearch/extensions/time/1.0/\"><entry><echo:originalFormat>ECHO10</echo:originalFormat></entry></feed>", :headers => {"date"=>["Fri, 17 Mar 2017 20:00:54 GMT"], "content-type"=>["application/echo10+xml; charset=utf-8"], "access-control-expose-headers"=>["CMR-Hits, CMR-Request-Id"], "access-control-allow-origin"=>["*"], "cmr-hits"=>["1"], "cmr-took"=>["107"], "cmr-request-id"=>["308d3b81-b229-4593-a05e-c61a741d45be"], "vary"=>["Accept-Encoding, User-Agent"], "connection"=>["close"], "server"=>["Jetty(9.2.z-SNAPSHOT)"], "strict-transport-security"=>["max-age=31536000"]})

      Cmr.process_updated_collections(raw_response, tester) 

      #checking that it brought in the new version of the record
      assert_equal(true, Collection.record_exists?("C1214614350-SCIOPS", "6"))
          
    end
  end
  
end
